!function(){"use strict";angular.module("fm",["ngRoute","ui.select","ui.bootstrap","ngSanitize"]).config(["$routeProvider","$httpProvider",function(e,t){e.when("/budgets",{templateUrl:"views/v-budget.html?r=38342&",controller:"BudgetController",controllerAs:"vm",resolve:{init:["ApiService",function(e){return e.getProfile()}]}}).when("/gds-tds",{templateUrl:"views/v-debt.html?r=38342&",controller:"DebtController",controllerAs:"vm",resolve:{init:["ApiService",function(e){return e.getProfile()}]}}).when("/stock-valuable",{templateUrl:"views/v-stock.html?r=38342&",controller:"StockController",controllerAs:"vm",resolve:{init:["ApiService",function(e){return e.getProfile()}]}}).when("/intrinsic-value",{templateUrl:"views/intrinsic-value.html?r=38342&",controller:"IntrinsicController",controllerAs:"vm",resolve:{init:["ApiService",function(e){return e.getProfile()}]}}).when("/dividend-calculator",{templateUrl:"views/dividend/dividend-calculator-add.html?r=38342&",controller:"DividendCalculatorAddController",controllerAs:"vm",resolve:{init:["ApiService",function(e){return e.getProfile()}]}}).when("/dividend-summary",{templateUrl:"views/dividend/dividend-summary.html?r=38342&",controller:"DividendSummaryController",controllerAs:"vm",resolve:{init:["ApiService",function(e){return e.getProfile()}]}}).when("/databank",{templateUrl:"views/stocks/databank.html?r=38342&",controller:"DatabankController",controllerAs:"vm",resolve:{init:["ApiService",function(e){return e.getProfile()}]}}).when("/screener",{templateUrl:"views/stocks/screener.html?r=38342&",controller:"ScreenerController",controllerAs:"vm",resolve:{init:["ApiService",function(e){return e.getProfile()}]}}).when("/watchlist",{templateUrl:"views/stocks/watchlist.html?r=38342&",controller:"WatchlistController",controllerAs:"vm",resolve:{init:["ApiService",function(e){return e.getProfile()}]}}).when("/portfolios",{templateUrl:"views/portfolio/index.html?r=38342&",controller:"PortfolioController",controllerAs:"vm",resolve:{init:["ApiService",function(e){return e.getProfile()}]}}).when("/banks",{templateUrl:"views/bank/index.html?r=38342&",controller:"BankController",controllerAs:"vm",resolve:{init:["ApiService",function(e){return e.getProfile()}]}}).when("/login",{templateUrl:"views/login.html?r=38342&",controller:"LoginController",controllerAs:"vm"}).when("/register",{templateUrl:"views/register.html?r=38342&",controller:"RegisterController",controllerAs:"vm"}).when("/forgot",{templateUrl:"views/forgot.html?r=38342&",controller:"ForgotController",controllerAs:"vm"}).when("/activate/:uid/:token",{templateUrl:"views/activate.html?r=38342&",controller:"ActivateController",controllerAs:"vm"}).when("/password/reset/confirm/:uid/:token",{templateUrl:"views/reset.html?r=38342&",controller:"ResetController",controllerAs:"vm"}).when("/403",{templateUrl:"views/403.html?r=38342&"}).when("/routing",{template:"<div></div>",controller:"RootController",controllerAs:"vm"}).otherwise("/budgets"),t.defaults.withCredentials=!1,t.defaults.xsrfCookieName="csrftoken",t.defaults.xsrfHeaderName="X-CSRFToken"}]).run(["$rootScope","$location","ApiService",function(e,t,n){n.checkToken()}]).constant("AppConfig",{API_PREFIX:"http://3.96.128.110/api/v1/"})}(),function(){"use strict";function e(e,t,n){let o=e.toLocaleString(void 0,{minimumFractionDigits:t,maximumFractionDigits:t});return n&&(o=n+o),o}angular.module("fm").filter("stockformat",["$filter",function(t){return function(t,n){if(void 0===t||Number.isNaN(t)||null===t)return"";if("N/A"===t)return t;if("%"===n.unit&&_.isNumber(t))return`${e(t,n.round||2)}%`;if("market"===n.unit){let n=Math.abs(t);return n>=1e9?`${e(t/1e9)}B`:n>1e6?`${e(t/1e6)}M`:e(t)}if(n.dateFormat){let e=t;return _.isDate(t)||(e=moment(t).toDate()),_.isDate(e)?e.format(n.dateFormat):e}if("number"==typeof t){let o=2;return void 0!==n.round&&(o=n.round),e(t,o)}return"string"==typeof t&&n.splitBy?t.split(n.splitBy)[0]:t}}])}(),function(){"use strict";angular.module("fm").filter("displayformat",["$filter",function(e){return function(e,t,n){if(void 0===e)return"N/A";if(!t||"N/A"==e)return e;let o="";if("string"==typeof t)switch(t){case"colorZero":o=n<0?"text-danger":0==n?"text-warning":"text-success";break;case"buySale":"BUY"==n?(o="bg-success text-white",e="BUY"):(o="bg-danger text-white",e="SALE");break;case"fixed":o="text-success"}else"function"==typeof t&&(o=t.call(void 0,e,n));return`<div class="${o}">${e}</div>`}}])}(),angular.module("fm").factory("ChartService",(function(){return{draw3DDonut:function(e,t,n){n=n||{},Highcharts.setOptions({colors:["#FFEA5D","#97EE5B","#5B8CFB","#ED6559","#B067FD","#F5AE5E","#5E5BF2","#CC51A8"]});let o={credits:!1,chart:{type:"pie",style:{fontFamily:'"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"'},options3d:{enabled:!0,alpha:20},backgroundColor:"#3b38d1"},title:{text:n.title||"",widthAdjust:-560,align:"center",verticalAlign:"middle",y:55},subtitle:{text:n.subTitle||"Summary of Monthly Budgeted Expenses",style:{color:"#fff",fontSize:"1.7rem",fontWeight:"bolder"}},plotOptions:{pie:{depth:45,innerSize:250,depth:114,size:340,startAngle:-65,dataLabels:{style:{fontSize:"16px"}}},series:{dataLabels:{enabled:!0,color:"red"}}},series:[{name:"Percentage",data:[]}]};_.each(t,((e,t)=>{o.series[0].data.push([`<span style='stroke-width:0;fill:#fff;font-size: 0.8rem; text-align: center'>${e[0]}-<span style='fill: orange;'>${e[3]}</span>: <span style='fill: #6AD7BB;'>${e[1]}</span> </span>`,e[2]])})),Highcharts.chart(e,o)},drawProgress:function(e,t,n){(n=n||{}).standard||(n.standard=32);let o={chart:{type:"bar",height:180,backgroundColor:"transparent",events:{render(){let e=this.renderer,o=this.series[1].data[0],i=this.xAxis[0].toPixels(o.x),a=this.yAxis[0].toPixels(n.standard)-1;this.customTarget&&(this.customTarget.destroy(),this.customTarget=void 0),this.customTarget=this.renderer.g("customTarget").attr({zIndex:20}).add(),e.path(["M",a,i-18,"L",a,i+17]).attr({fill:"#076e96",stroke:"#076e96","stroke-width":3}).add(this.customTarget);const r=this.yAxis[0].toPixels(t)-10;e.path(["M",9.5,14.25,"l",-5.584,2.936,1.066,-6.218,"L",.465,6.564,"l",6.243,-.907,"L",9.5,0,"l",2.792,5.657,6.243,.907,-4.517,4.404,1.066,6.218]).attr({fill:"white",stroke:"white","stroke-width":1,transform:"translate("+r+","+(i-10)+")"}).add(this.customTarget),e.path(["M",r+10,i+7,"L",r+10,i+35]).attr({fill:"white",stroke:"white","stroke-width":2}).add(this.customTarget);let s=r-10,c=i+30;t<5?s=r+2:t>95&&(s=r-50),e.rect(s,c,70,30,5).attr({fill:"white",stroke:"white","stroke-width":1}).add(this.customTarget),e.text(`${t}%`,s+35,c+20).attr({fill:"#93c608","font-size":"17px","font-weight":"bold",align:"center"}).add(this.customTarget)}}},title:{text:n.title||"",align:"center",margin:0,useHTML:!0,style:{"background-color":"#93c608","font-size":"20px","font-weight":"bold",color:"white","border-radius":"5px",padding:"5px 10px"}},subtitle:{text:n.subTitle||"",verticalAlign:"bottom"},credits:!1,legend:!1,tooltip:{enabled:!1},plotOptions:{bar:{stacking:"normal",borderWidth:0,borderRadius:3},series:{pointWidth:30}},xAxis:{visible:!1},yAxis:{visible:!0,min:0,max:100,title:{text:null},gridLineWidth:0,labels:{format:"{value}%",y:25,style:{fontSize:"17px",color:"#076e96"}},opposite:!0,tickPositions:[0,10,n.standard,100]},series:[{name:"Fill",data:[100],color:"red",grouping:!1,enableMouseTracking:!1},{name:"Percentage",data:[n.standard||32],color:"#93c608",dataLabels:{enabled:!1}}]};console.log(o),Highcharts.chart(e,o)}}})),angular.module("fm").factory("ApiService",["$rootScope","$http","$location","AppConfig",function(e,t,n,o){var i=o.API_PREFIX,a=null;function r(){console.log("[ApiService] logout()"),a="",localStorage.removeItem("t"),t.defaults.headers.common.Authorization=void 0,e.me=null}return{login:function(e,n){return console.log("[ApiService] login():",e),t.post(i+"auth/login/",{username:e,password:n}).then((function(e){a=e.data.token,t.defaults.headers.common.Authorization="JWT "+a,localStorage.setItem("t",a)}))},logout:r,getProfile:function(){return console.log("[ApiService] getProfile()"),e.me?Promise.resolve(e.me):t.get(i+"user/profile/").then((function(t){return console.log("[ApiService] getProfile() then"),e.me=t.data,e.permissions=function(e){let t=e.user_permissions;return _.each(e.groups,(e=>{e.permissions&&(t=_.concat(t,e.permissions))})),t}(e.me),e.$broadcast("LOGGEDIN",t.data),t.data})).catch((e=>{console.log("[ApiService] getProfile() catch"),401==e.status&&r()}))},getBudgets:function(){return console.log("[ApiService] getBudgets():"),t.get(i+"budget/budgets/",{params:{page:1,page_size:100}}).then((function(e){return e.data}))},updateBudget:function(e,n){return t.patch(`${i}budget/budgets/${e}/`,{name:n.name,title:n.title,pie_title:n.pie_title})},createCategory:function(e){return t.post(i+"budget/categories/",e)},updateCategory:function(e,n){return t.put(`${i}budget/categories/${e}/`,n)},deleteCategory:function(e){return t.delete(`${i}budget/categories/${e}/`)},createItem:function(e){return t.post(i+"budget/category_items/",e)},updateItem:function(e,n){return t.put(`${i}budget/category_items/${e}/`,n)},deleteItem:function(e){return t.delete(`${i}budget/category_items/${e}/`)},itemUp:function(e){return t.post(i+`budget/category_items/${e}/move_up/`)},itemDown:function(e){return t.post(i+`budget/category_items/${e}/move_down/`)},checkToken:function(){var e=localStorage.getItem("t");return!!e&&(a=e,t.defaults.headers.common.Authorization=`JWT ${e}`,!0)},copyBudget:function(e){return t.post(i+`budget/budgets/${e}/copy/`,{})},deleteBudget:function(e){return t.delete(i+`budget/budgets/${e}/`)},register:function(e){return t.post(`${i}user/register/`,e)},forgot:function(e){return t.post(i+"djoser/users/reset_password/",e).then((e=>e))},activate:function(e){return t.post(`${i}djoser/users/activation/`,e)},reset:function(e){return t.post(`${i}djoser/users/reset_password_confirm/`,e)},createAnnualIncome:function(e){return t.post(i+"budget/annual_incomes/",e)},updateAnnualIncome:function(e,n){return t.put(`${i}budget/annual_incomes/${e}/`,n)},deleteAnnualIncome:function(e){return t.delete(`${i}budget/annual_incomes/${e}/`)},annualIncomeUp:function(e){return t.post(i+`budget/annual_incomes/${e}/move_up/`)},annualIncomeDown:function(e){return t.post(i+`budget/annual_incomes/${e}/move_down/`)},createNetAsset:function(e){return t.post(i+"budget/netassets/",e)},updateNetAsset:function(e,n){return t.put(`${i}budget/netassets/${e}/`,n)},deleteNetAsset:function(e){return t.delete(`${i}budget/netassets/${e}/`)},netAssetUp:function(e){return t.post(i+`budget/netassets/${e}/move_up/`)},netAssetDown:function(e){return t.post(i+`budget/netassets/${e}/move_down/`)},createLiability:function(e){return t.post(i+"budget/liabilities/",e)},updateLiability:function(e,n){return t.put(`${i}budget/liabilities/${e}/`,n)},deleteLiability:function(e){return t.delete(`${i}budget/liabilities/${e}/`)},liabilityDown:function(e){return t.post(i+`budget/liabilities/${e}/move_down/`)},liabilityUp:function(e){return t.post(i+`budget/liabilities/${e}/move_up/`)}}}]),function(){"use strict";function e(e,t){function n(n,o){if(console.log("hasPermission:",e.me),!e.me)return t.path("/login");if(e.me&&e.me.is_superuser)return!0;let i=`${o=o||"view"}_${n}`;return!!_.find(e.permissions,["codename",i])}function o(e){return!!n(e)||(t.path("/403"),!1)}return{hasPermission:n,is_permit:o,firstAuthPage:function(){let e=!1;return _.each({budget:"budgets",debt:"gds-tds",stock:"stock-valuable",intrinsicstock:"intrinsic-value"},((t,n)=>{if(o(n))return e=t,!1})),e}}}angular.module("fm").factory("PermissionService",e),e.$inject=["$rootScope","$location"]}(),angular.module("fm").factory("DebtApi",["$http","AppConfig",function(e,t){var n=t.API_PREFIX;return{getDebts:function(){return console.log("[ApiService] getDebts():"),e.get(n+"debt/debts/",{params:{page:1,page_size:100}}).then((function(e){return e.data}))},updateDebt:function(t,o){return e.patch(`${n}debt/debts/${t}/`,o)},copyDebt:function(){return e.post(n+"debt/debts/copy/",{})},deleteDebt:function(t){return e.delete(n+`debt/debts/${t}/`)},createCategory:function(t){return e.post(n+"debt/categories/",t)},updateCategory:function(t,o){return e.put(`${n}debt/categories/${t}/`,o)},deleteCategory:function(t){return e.delete(`${n}debt/categories/${t}/`)},createItem:function(t){return e.post(`${n}debt/category_items/`,t)},updateItem:function(t,o){return e.put(`${n}debt/category_items/${t}/`,o)},deleteItem:function(t){return e.delete(`${n}debt/category_items/${t}/`)},createLiability:function(t){return e.post(`${n}debt/liabilites/`,t)},updateLiability:function(t,o){return e.put(`${n}debt/liabilites/${t}/`,o)},createLiabilityItem:function(t){return e.post(`${n}debt/liability_items/`,t)},updateLiabilityItem:function(t,o){return e.put(`${n}debt/liability_items/${t}/`,o)},deleteLiabilityItem:function(t){return e.delete(`${n}debt/liability_items/${t}/`)}}}]),angular.module("fm").factory("NotifyService",(function(){return{show:function(e){Notification.requestPermission().then((function(t){new Notification(e).onclick=function(){window.focus()}}))}}})),angular.module("fm").factory("StockService",["$http","AppConfig",function(e,t){var n=t.API_PREFIX;return{getStocks:function(){return console.log("[StockService] getStocks()"),e.get(n+"stock/stocks/",{params:{page:1,page_size:100}}).then((function(e){return e.data}))},addStock:function(t){return e.post(`${n}stock/stocks/`,t)},updateStock:function(t,o){return e.patch(`${n}stock/stocks/${t}/`,{code:o.code})},deleteStock:function(t){return e.delete(n+`stock/stocks/${t}/`)},getIntrinsicStocks:function(){return console.log("[StockService] getIntrinsicStocks()"),e.get(n+"stock/intrinsic_stocks/",{params:{page:1,page_size:100}}).then((function(e){return e.data}))},addIntrinsicStock:function(t){return e.post(`${n}stock/intrinsic_stocks/`,t)},updateIntrinsicStock:function(t,o){return e.patch(`${n}stock/intrinsic_stocks/${t}/`,{code:o.code})},deleteIntrinsicStock:function(t){return e.delete(n+`stock/intrinsic_stocks/${t}/`)},getBondYield:function(){return e.get(`${n}stock/bondyields/`).then((function(e){return e.data}))},addDividendStock:function(t){return e.post(`${n}stock/dividend_stocks/`,t)},getDividendStocks:function(t){return e.get(`${n}stock/dividend_stocks/`,{params:t}).then((function(e){return e.data}))},updateDividendStock:function(t,o){return e.put(`${n}stock/dividend_stocks/${t}/`,o)},deleteDividendStock:function(t){return e.delete(`${n}stock/dividend_stocks/${t}/`)},buyDividendStock:function(t){return e.post(`${n}stock/dividend_stocks/buy/`,t)},sellDividendStock:function(t,o){return e.post(`${n}stock/dividend_stocks/${t}/sell/`,o)},stockInfo:function(t){return e.get(`${n}stock/info/`,{params:{symbol:t}})},stockChart:function(t){return e.get(`${n}stock/chart/`,{params:{symbol:t}})},stockProfile:function(t){return e.get(`${n}stock/profile/`,{params:{symbol:t}})},stockFinances:function(t){return e.get(`${n}stock/finances/`,{params:{symbol:t}})},findStocks:function(t){return e.get(`${n}stock/find_stocks/`,{params:{q:t}})},getStockNote:function(){return e.get(`${n}stock/stock_note/`)},updateStockNote:function(t){return e.post(`${n}stock/stock_note/`,t)},STOCK_FIELDS:[{no:1,name:"Stock Name",field:"displayName"},{no:2,name:"Current Stock Price",field:"currentStockPrice"},{no:3,name:"Sector",field:"sector",splitBy:" "},{no:4,name:"Industry",field:"industry",splitBy:"—"},{no:5,name:"Price Change",field:"priceChangePercentage",colorMinus:!0,format:"colorZero",unit:"%"},{no:6,name:"10 Day Moving Average",field:"averageTenDays",rowColor:"bg-success text-white"},{no:7,name:"Market Cap",field:"marketCap",unit:"market"},{no:8,name:"52 Week Low",field:"fiftyTwoWeekLow"},{no:9,name:"52 Week High",field:"fiftyTwoWeekHigh"},{no:10,name:"% Fall: 52 Week High to Low",field:"percentFall",unit:"%"},{no:11,name:"Discount from 52 Week High",field:"discountFrom52WeekHigh",unit:"%"},{name:"Earnings, Income & Growth",heading:!0,rowColor:"bg-warning"},{no:12,name:"Earnings Yield (LTM) (per share)",field:"earningsYield",unit:"%"},{no:13,name:"EPS (TTM) ↑",field:"trailingEPS",rowColor:"bg-success text-white"},{no:14,name:"EPS Forecast ↑",field:"epsForecast"},{no:15,name:"Revenue Growth Forecast 1YR",field:"revenueForecast",unit:"%"},{no:16,name:"P/E Ratio (LTM) (<20 ideal) ↓",field:"trailingPE",rowColor:"bg-success text-white"},{no:17,name:"Gross Profit Growth (LTM) ↑",field:"grossProfitGrowth",unit:"%"},{no:18,name:"Net Profit Growth (LTM) ↑",field:"netProfitGrowth",unit:"%"},{no:19,name:"Net Income Margin (LTM) ↑",field:"netIncomeMargin",unit:"%",rowColor:"bg-primary text-white"},{no:20,name:"BM Score > -2.22 More Neg is better"},{no:21,name:"Net Income Forecast CAGR (5y)",field:"netIncomeForecast",unit:"%"},{no:22,name:"Return on Equity CAGR (3y)↑ 14%",field:"roe",unit:"%",rowColor:"bg-success text-white"},{no:23,name:"Free Cash Flow Yield (LTM) ↑ >5",field:"freeCashFlowYield",unit:"%",rowColor:"bg-success text-white"},{no:24,name:"Total Shareholder Yield (LTM) ↑",field:"totalShareHolder",unit:"%",rowColor:"bg-primary text-white"},{name:"DIVIDENDS Dividends are a bonus to investing in a good company",heading:!0,rowColor:"bg-warning"},{no:25,name:"Dividends Per Share",field:"dividendsPerShare"},{no:26,name:"Dividend Mean Forecast",field:"dividendMeanForecast"},{no:27,name:"Dividend Yield (LTM) ↑ 4%",field:"dividendYield",unit:"%"},{no:28,name:"Dividend Payout Ratio (LTM)",field:"dividendPayoutRatio",unit:"%"},{no:29,name:"Dividend Growth Rate (LTM) ↑",field:"dividendGrowthRate",unit:"%"},{no:30,name:"Dividend Frequency",field:"dividendFrequency"},{name:"FINANCIALS. Does the company run on good margins?",heading:!0,rowColor:"bg-warning"},{no:31,name:"Total Revenue (LTM)",field:"totalRevenue",unit:"market"},{no:32,name:"Cost of Goods (LTM)",field:"costOfGoods",unit:"market"},{no:33,name:"Operating Income / Loss (LTM)",field:"operatingIncome",unit:"market"},{no:34,name:"Gross Profit (LTM)",field:"grossProfit",unit:"market"},{no:35,name:"Cost of Goods Margin (LTM) ↓",field:"costOfGoodsMargin",unit:"%"},{no:36,name:"Gross Margin (LTM) ↑",field:"grossMargin",unit:"%"},{no:37,name:"Operating Margin (LTM) ↑",field:"operatingMargin",unit:"%"},{no:38,name:"Altman Z-score",field:"zscore"},{name:"BALANCE SHEET. Is the comapany financially stable?",heading:!0,rowColor:"bg-warning"},{no:39,name:"Total Cash & Short T Investments (Q)",field:"totalCash",unit:"market"},{no:40,name:"Total Current Assets (Q)",field:"totalCurrentAssets",unit:"market"},{no:41,name:"- Total Current Liabilities (Q)",field:"totalCurrentLiabilities",unit:"market"},{no:42,name:"= Total 1 Year Current Excess ↑",field:"total1YearExcess",unit:"market"},{no:43,name:"C Assets V. C Liabilities ↑ >1",field:"currentAssetsPerLiabilities"},{no:44,name:"Total Assets (Q)",field:"totalAssets",unit:"market"},{no:45,name:"Total Liabilities (Q)",field:"totalLiabilities",unit:"market"},{no:46,name:"T Assets V. T Liabilities ↑ TATL Ratio",field:"totalAssetsPerLiabilities",rowColor:"bg-success text-white"},{no:47,name:"Total Stockholders Equity (Q) ↑",field:"totalStockholderEquity",unit:"market"},{no:48,name:"D/E Debt Equity Ratio ↓",field:"debtEquityRatio"},{name:"↑↑ The Info Above Gives The Financial Analysis Of The Stock Companies. Which Companies Are The Strongest? ↑↑",heading:!0,rowColor:"bg-yellow"},{name:" ",heading:!0,rowColor:"bg-white"},{name:"↓↓ The Info Below Are Valuations, Price Targets, and Analyst Sentiment (All are subjective) ↓↓",heading:!0,rowColor:"bg-yellow"},{name:"Price To Earnings Valuation",heading:!0,rowColor:"bg-warning"},{no:49,name:"Forward P/E (Predicted) ↑",field:"forwardPE"},{no:50,name:"1 Year ADJ PE ratio",field:"oneYearAdjRatio"},{no:51,name:"Current P/E (<20 is ideal)",field:"currentPE"},{no:52,name:"P/E Discount From 1yr Avg ↑",field:"peDiscount",unit:"%"},{name:"Peter Lynch Fair Value Estimator (My formula is modified) - Just a quick check indicator. Not A Determining Factor",heading:!0,rowColor:"bg-warning"},{no:53,name:"Peter Lynch Estimator",field:"peterLynchEstimator",colorFunc:function(e){return e?"Overvalued"===e?"text-danger":"Undervalued"===e?"text-success":"":""}},{name:"Fair Value Intrinsic Estimator",heading:!0,rowColor:"bg-warning"},{no:54,name:"Estimated Intrinsic Value",field:""},{no:55,name:"Fair Value Int. Upside Estimate ↑",field:""},{no:56,name:"Fair Value Int. Uncertainty ↓",field:""}],INTRINSIC_FIELDS:[{name:"Company Name",field:"displayName"},{name:"EXchange",field:"exchange"},{name:"Current Price",field:"currentStockPrice"},{name:"Dividend",field:"dividendsPerShare"},{name:"Dividend Yield",field:"dividendYield",unit:"%"},{name:"Dividend Frequency",field:"dividendFrequency"},{name:"Payment Date",field:"dividendDate",dateFormat:"mmm dd, yyyy"},{name:"Ex-Dividend Date",field:"exDividendDate",dateFormat:"mmm dd, yyyy"},{name:"EPS",field:"trailingEPS"},{name:"Next 5 years (per annum)",field:"netIncomeForecast",unit:"%"},{name:"AAA Bond Yield",field:"bondYield",unit:"%"},{name:"P/E",field:"fixedPE",format:"fixed"},{name:"1g",field:"fixed1G",format:"fixed"},{name:"Corp Bond",field:"fixedCorpBond",format:"fixed"},{name:"Intrinsic Value",field:"intrinsic"},{name:"BUY/SALE",field:"buy_or_sale",format:"buySale"},{name:"Upside",field:"upside",unit:"%"}],DIVIDEND_FIELDS:[{name:"Company Name",field:"displayName"},{name:"Exchange",field:"exchange"},{name:"Share Price",field:"currentStockPrice"},{name:"Dividend Frequency",field:"dividendFrequency"},{name:"Dividend Per Share",field:"dividendsPerShare"},{name:"Dividend Yield",field:"dividendYield",unit:"%"},{name:"Ex-Dividend Date",field:"exDividendDate",dateFormat:"mmm dd, yyyy"},{name:"Payment Date",field:"dividendDate",dateFormat:"mmm dd, yyyy"},{name:"Forward Annual Dividend Rate",field:"forwardDividend"}],DIVIDEND_SUMMARY_FIELDS:[{name:"Stock Name",field:"displayName"},{name:"Symbol",field:"code"},{name:"Exchange",field:"exchange"},{name:"Share Price",field:"priceChangeDisplay",format:function(e,t){return"bg-yellow"}},{name:"Dividend Frequency",field:"dividendFrequency"},{name:"Dividend Per Share",field:"dividendsPerShare",round:2,format:function(e,t){return"bg-success text-white"}},{name:"Dividend Yield",field:"dividendYield",unit:"%"},{name:"Payout Ratio",field:"payoutRatio",unit:"%"},{name:"Ex-Dividend Date",field:"exDividendDate",dateFormat:"mmm dd, yyyy"},{name:"Payment Date",field:"dividendDate",dateFormat:"mmm dd, yyyy"},{name:"Share Bought",field:"init_share",round:0},{name:"Cost Average",field:"init_price",round:4},{name:"Profit/Loss",field:"profit_or_lost",format:function(e,t){return t>0?"bg-yellow text-success":"bg-yellow text-danger"}},{name:"Profit/Loss (%)",field:"profit_or_lost_percent",unit:"%",format:function(e,t){return t>0?"bg-yellow text-success":"bg-yellow text-danger"}}]}}]),angular.module("fm").factory("YahooService",["$http","AppConfig",function(e,t){var n=t.API_PREFIX,o={},i={},a={},r={};function s(e){return o[e]||null}function c(e){return i[e]||null}function l(e){return a[e]||null}function d(e){return r[e]||null}function u(e){if(!e.balanceSheetHistoryQuarterly.balanceSheetStatements)return"N/A";let t="N/A";return _.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.cash)return t=e.cash.raw,t+=e.shortTermInvestments?e.shortTermInvestments.raw:0,!1})),t}function m(e){if(!e.balanceSheetHistoryQuarterly.balanceSheetStatements)return"N/A";let t="N/A";return _.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.totalCurrentAssets)return t=e.totalCurrentAssets.raw,!1})),t}function f(e){if(!e.balanceSheetHistoryQuarterly.balanceSheetStatements)return"N/A";let t="N/A";return _.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.totalCurrentLiabilities)return t=e.totalCurrentLiabilities.raw,!1})),t}function h(e){if(!e.balanceSheetHistoryQuarterly.balanceSheetStatements)return"N/A";let t="N/A";return _.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.totalAssets)return t=e.totalAssets.raw,!1})),t}function g(e){if(!e.balanceSheetHistoryQuarterly.balanceSheetStatements)return"N/A";let t="N/A";return _.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.totalLiab)return t=e.totalLiab.raw,!1})),t}function p(e){if(!e.balanceSheetHistoryQuarterly.balanceSheetStatements)return"N/A";let t="N/A";return _.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.totalStockholderEquity)return t=e.totalStockholderEquity.raw,!1})),t}function y(t,o){var i=new Date,a=i.getUTCDate()+1,r=i.getUTCMonth(),s=i.getUTCFullYear(),c=Date.UTC(s-o,r,a)/1e3,l=Date.UTC(s-(o-1),r,a)/1e3;return e.get(`${n}stock/yahoo_chart/`,{params:{symbol:t,p1:c,p2:l}})}return{getQuote:function(t){if(console.log("[YahooService] getQuote()"),!_.isArray(t))return Promise.reject();t=_.uniq(t);let i=!0;return _.each(t,(e=>{if(!s(e))return i=!1,!1})),i?Promise.resolve():(t=t.join(","),e.get(`${n}stock/yahoo_quote/`,{params:{symbols:t}}).then((function({data:e}){return function(e){_.each(e.quoteResponse.result,(e=>{o[e.symbol]=e}))}(e),e})))},getQuoteSummary:function(t){console.log("[YahooService] getSummaryQuote()");let o=c(t);return o?Promise.resolve(o):e.get(`${n}stock/yahoo_quote_summary/`,{params:{symbol:t}}).then((function({data:e}){return function(e,t){i[e]=t.quoteSummary.result[0]}(t,e),e}))},parseStock:function(e){let t=s(e),n=c(e),o=l(e),i=d(e),a={symbol:e,displayName:t.displayName||t.shortName,longName:t.longName,currentStockPrice:t.regularMarketPrice,currency:t.currency,marketCap:t.marketCap,trailingPE:t.trailingPE,forwardPE:t.forwardPE,currentPE:t.trailingPE,exchange:t.fullExchangeName,dividendDate:t.dividendDate?new Date(1e3*t.dividendDate):"N/A",industry:n.assetProfile.industry.split("—")[0],priceChange:_.round(n.price.regularMarketChange.raw,2),priceChangePercentage:100*n.price.regularMarketChangePercent.raw,lastPrice:n.price.regularMarketPreviousClose.raw,dailyHigh:n.price.regularMarketDayHigh.raw,dailyLow:n.price.regularMarketDayLow.raw,dailyVolume:n.price.regularMarketVolume.raw,priceChangeDisplay:"N/A",marketTime:t.regularMarketTime.raw,sector:n.assetProfile.sector,fiftyTwoWeekLow:n.summaryDetail.fiftyTwoWeekLow.raw,fiftyTwoWeekHigh:n.summaryDetail.fiftyTwoWeekHigh.raw,fiftyDayAverage:n.summaryDetail.fiftyDayAverage.raw,twoHundredDayAverage:n.summaryDetail.twoHundredDayAverage.raw,trailingEPS:n.defaultKeyStatistics.trailingEps.raw,epsForecast:n.defaultKeyStatistics.forwardEps.raw,exDividendDate:(r=n,r.summaryDetail.exDividendDate&&r.summaryDetail.exDividendDate.raw?new Date(1e3*r.summaryDetail.exDividendDate.raw):"N/A"),grossProfitGrowth:100*(n.incomeStatementHistory.incomeStatementHistory[0].grossProfit.raw-n.incomeStatementHistory.incomeStatementHistory[1].grossProfit.raw)/n.incomeStatementHistory.incomeStatementHistory[1].grossProfit.raw,netProfitGrowth:100*(n.incomeStatementHistory.incomeStatementHistory[0].netIncome.raw-n.incomeStatementHistory.incomeStatementHistory[1].netIncome.raw)/n.incomeStatementHistory.incomeStatementHistory[1].netIncome.raw,netIncomeMargin:100*_.sumBy(n.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.netIncome.raw))/_.sumBy(n.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.totalRevenue.raw)),dividendsPerShare:n.summaryDetail.dividendRate.raw||0,dividendYield:100*(n.summaryDetail.dividendYield.raw||0),totalRevenue:_.sumBy(n.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.totalRevenue.raw)),costOfGoods:_.sumBy(n.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.costOfRevenue.raw)),operatingIncome:_.sumBy(n.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.operatingIncome.raw)),grossProfit:_.sumBy(n.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.grossProfit.raw)),totalCash:u(n),totalCurrentAssets:m(n),totalCurrentLiabilities:f(n),totalAssets:h(n),totalLiabilities:g(n),totalStockholderEquity:p(n),averageTenDays:"N/A",percentFall:"N/A",discountFrom52WeekHigh:"N/A",earningsYield:"N/A",revenueForecast:"N/A",netIncomeForecast:"N/A",roe:"N/A",freeCashFlowYield:"N/A",totalShareHolder:"N/A",dividendGrowthRate:"N/A",dividendMeanForecast:"N/A",dividendPayoutRatio:"N/A",dividendFrequency:"N/A",grossMargin:"N/A",operatingMargin:"N/A",zscore:"N/A",total1YearExcess:"N/A",currentAssetsPerLiabilities:"N/A",totalAssetsPerLiabilities:"N/A",debtEquityRatio:"N/A",oneYearAdjRatio:"N/A",peDiscount:"N/A",peterLynchEstimator:"N/A",costOfGoodsMargin:"N/A",payoutRatio:100*n.summaryDetail.payoutRatio.raw,beta:n.summaryDetail.beta.raw};var r;return a.percentFall=a.fiftyTwoWeekLow?100*(a.fiftyTwoWeekHigh-a.fiftyTwoWeekLow)/a.fiftyTwoWeekLow:"N/A",a.discountFrom52WeekHigh=a.fiftyTwoWeekHigh?100*(a.fiftyTwoWeekHigh-a.currentStockPrice)/a.fiftyTwoWeekHigh:"N/A",a.earningsYield=1/a.trailingPE*100,a.roe=100*(Math.pow(n.incomeStatementHistory.incomeStatementHistory[0].netIncome.raw/n.balanceSheetHistory.balanceSheetStatements[0].totalStockholderEquity.raw/(n.incomeStatementHistory.incomeStatementHistory[3].netIncome.raw/n.balanceSheetHistory.balanceSheetStatements[3].totalStockholderEquity.raw),1/3)-1),a.freeCashFlowYield=function(e,t){let n=_.sumBy(e.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.totalCashFromOperatingActivities?e.totalCashFromOperatingActivities.raw:0));return n+=_.sumBy(e.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.capitalExpenditures?e.capitalExpenditures.raw:0)),e.defaultKeyStatistics.sharesOutstanding?(n/=e.defaultKeyStatistics.sharesOutstanding.raw,_.round(100*n/t.currentStockPrice,2)):"N/A"}(n,a),a.totalShareHolder=function(e,t){let n=0,o=0;return t.dividendsPerShare>0&&(o=_.sumBy(e.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.dividendsPaid?e.dividendsPaid.raw:0)),n-=o),o=_.sumBy(e.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.repurchaseOfStock?e.repurchaseOfStock.raw:0)),n-=o,o=_.sumBy(e.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.issuanceOfStock?e.issuanceOfStock.raw:0)),n-=o,n=100*n/t.marketCap,n}(n,a),a.dividendMeanForecast=a.dividendsPerShare*(1+a.dividendGrowthRate),a.dividendPayoutRatio=a.dividendsPerShare<=0?0:-100*_.sumBy(n.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.dividendsPaid?e.dividendsPaid.raw:0))/(_.sumBy(n.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.totalCashFromOperatingActivities?e.totalCashFromOperatingActivities.raw:0))+_.sumBy(n.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.capitalExpenditures?e.capitalExpenditures.raw:0))),a.grossMargin=_.round(100*(a.totalRevenue-a.costOfGoods)/a.totalRevenue,2),a.operatingMargin=_.round(100*a.operatingIncome/a.totalRevenue,2),a.total1YearExcess=a.totalCurrentAssets-a.totalCurrentLiabilities,a.currentAssetsPerLiabilities=_.round(a.totalCurrentAssets/a.totalCurrentLiabilities,2),a.totalAssetsPerLiabilities=_.round(a.totalAssets/a.totalLiabilities,2),a.debtEquityRatio=a.totalLiabilities/a.totalStockholderEquity,a.oneYearAdjRatio=n.earningsHistory?a.currentStockPrice/_.sumBy(n.earningsHistory.history,(e=>e.epsActual.raw)):"N/A",a.peDiscount=(a.currentPE-a.oneYearAdjRatio)/a.oneYearAdjRatio*-100,a.costOfGoodsMargin=_.round(100*a.costOfGoods/a.totalRevenue,2),a.peterLynchEstimator=function(e,t){let n=t.trailingEPS,o=t.currentStockPrice,i=100*function(e){if(!e.earnings)return"N/A";let t=e.earnings.financialsChart.yearly;if(t.length<=1)return"N/A";var n=parseFloat(t[0].earnings.raw),o=parseFloat(t[t.length-1].earnings.raw);return Math.abs(o/n)**(1/(t.length-1))-1}(e)*n/o;return i<.9?"Overvalued":i<=1.1?"Near Value":"Undervalued"}(n,a),a.zscore=function(e,t){let n=t.total1YearExcess/t.totalAssets*1.2;if(e.balanceSheetHistoryQuarterly.balanceSheetStatements){let o=0;_.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.retainedEarnings)return o=e.retainedEarnings.raw,!1})),n+=o/t.totalAssets*1.4}return n+=_.sumBy(e.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.ebit?e.ebit.raw:0))/t.totalAssets*3.3,n+=t.marketCap/t.totalLiabilities*.6,n+=t.totalRevenue/t.totalAssets*1,n}(n,a),a.dividendFrequency=function(e){let t=e[0],n=0;try{n=_.size(t.chart.result[0].events.dividends)}catch(e){console.log("No dividend paid data")}var o="";switch(n){case 0:o="Growth";break;case 1:o="Annually";break;case 2:o="Semi-annually";break;case 4:o="Quarterly";break;case 12:o="Monthly";break;default:o=n.toString()}return o}(o),a.dividendGrowthRate=function(e){let t=e[0],n=e[1],o=0,i=0,a=0;try{o=_.sumBy(_.map(t.chart.result[0].events.dividends,(e=>e.amount))),i=_.sumBy(_.map(n.chart.result[0].events.dividends,(e=>e.amount)))}catch(e){console.log("No dividend paid data")}return a=i>0?100*(o-i)/i:0,a}(o),a.dividendMeanForecast=a.dividendsPerShare*(1+a.dividendGrowthRate/100),a.revenueForecast=function(e){if(!e.earningsTrend)return"N/A";let t=_.find(e.earningsTrend.trend,(e=>"+1y"==e.period));return t?100*t.revenueEstimate.growth.raw:"N/A"}(n),a.averageTenDays=function(e){let t=[];try{t=e.chart.result[0].indicators.adjclose[0].adjclose}catch(e){console.log("No AdjClose Data")}return t.length?_.sum(t)/t.length:"N/A"}(i),a.netIncomeForecast=function(e){if(!e.earningsTrend)return"N/A";let t=_.find(e.earningsTrend.trend,(e=>"+5y"==e.period));return t?100*t.growth.raw:"N/A"}(n),a.priceChangeDisplay=function(e){var t="",n="|";e.priceChange<0?(t="text-danger",n="▼"):e.priceChange>0&&(t="text-success",n="▲");let o=`<span class="${t}">${e.currentStockPrice} ${n} ${e.priceChange} (${_.round(e.priceChangePercentage,2)}%)</span>`;if(e.marketTime){let t=moment.tz.guess();o=`${o}<small class="d-block">Closed at ${moment(1e3*e.marketTime).tz(t).format("MMM DD H:mm a z")}</small>`}return o}(a),a},getChart:function(e){console.log("[YahooService] getChart()");let t=l(e);return t?Promise.resolve(t):(a[e]=[],y(e,1).then((function({data:t}){return a[e][0]=t,y(e,2).then((({data:t})=>{a[e][1]=t}))})))},getHistory:function(t,o){console.log("[YahooService] getHistory()"),o||(o=10);let i=d(t);if(i)return Promise.resolve(i);r[t]=null;var a=new Date,s=a.getUTCDate()+1,c=a.getUTCMonth(),l=a.getUTCFullYear(),u=Date.UTC(l,c,s)/1e3,m=u-86400*o;return e.get(`${n}stock/yahoo_history/`,{params:{symbol:t,p1:m,p2:u}}).then((({data:e})=>(r[t]=e,e)))},findStocks:function(t){return e.get(`${n}stock/yahoo_find_stocks/`,{params:{q:t}}).then((function({data:e}){return e}))}}}]),angular.module("fm").factory("ConfirmService",["$rootScope","$q",function(e,t){var n=this;return e.$on("CONFIRM_MODAL_CONFIRM",(e=>{n.defer.resolve()})),{show:function(o){return console.log("[ConfirmService] show()"),n.defer=t.defer(),e.$broadcast("CONFIRM_MODAL_SHOW",o||{}),n.defer.promise}}}]),angular.module("fm").factory("ToastService",["$rootScope","$q",function(e){function t(t){console.log("[ToastService] show()"),e.$broadcast("TOAST_SHOW",t||{})}return{show:t,success:function(e){t(e=_.extend(e,{bgClass:"bg-success",borderClass:"border-success"}))},danger:function(e){t(e=_.extend(e,{bgClass:"bg-danger",borderClass:"border-danger"}))}}}]),(()=>{function e(){function e(e){if(!e.balanceSheetHistoryQuarterly.balanceSheetStatements)return"N/A";let t="N/A";return _.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.cash)return t=e.cash.raw,t+=e.shortTermInvestments?e.shortTermInvestments.raw:0,!1})),t}function t(e){if(!e.balanceSheetHistoryQuarterly.balanceSheetStatements)return"N/A";let t="N/A";return _.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.totalCurrentAssets)return t=e.totalCurrentAssets.raw,!1})),t}function n(e){if(!e.balanceSheetHistoryQuarterly.balanceSheetStatements)return"N/A";let t="N/A";return _.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.totalCurrentLiabilities)return t=e.totalCurrentLiabilities.raw,!1})),t}function o(e){if(!e.balanceSheetHistoryQuarterly.balanceSheetStatements)return"N/A";let t="N/A";return _.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.totalAssets)return t=e.totalAssets.raw,!1})),t}function i(e){if(!e.balanceSheetHistoryQuarterly.balanceSheetStatements)return"N/A";let t="N/A";return _.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.totalLiab)return t=e.totalLiab.raw,!1})),t}function a(e){if(!e.balanceSheetHistoryQuarterly.balanceSheetStatements)return"N/A";let t="N/A";return _.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.totalStockholderEquity)return t=e.totalStockholderEquity.raw,!1})),t}function r(e,t,n){let o,i,a,r;switch(t||(t="current"),t){case"current":o=e.price,i=e.price_change,a=e.percent_change,r=e.market_time;break;case"pre":o=e.pre_price,i=e.pre_price_change,a=e.pre_percent_change,r=e.pre_market_time}var s="",c="|";if(void 0===o||null==o)return"";i<0?(s="text-danger",c="▼"):i>0?(s="text-success",c="▲"):s="text-warning";let l=`<span class="${s}">${_.round(o,2)} ${c} ${_.round(i,2)} (${_.round(a,2)}%)</span>`;if(r&&n){let e=Intl.DateTimeFormat().resolvedOptions().timeZone;l=`${l}<small class="d-block">Closed at ${moment(1e3*r).tz(e).format("MMM DD H:mm a z")}</small>`}return l}return{parse:function(r){let s=r.summary.symbol,c=r.summary.quoteData[s],l=r.summary,d=r.chart,u={symbol:s,displayName:c.displayName||c.shortName,longName:c.longName,currentStockPrice:c.regularMarketPrice.raw,currency:c.cuurency,marketCap:c.marketCap.raw,trailingPE:l.summaryDetail.trailingPE?l.summaryDetail.trailingPE.raw:"N/A",forwardPE:l.summaryDetail.forwardPE.raw,currentPE:l.summaryDetail.trailingPE?l.summaryDetail.trailingPE.raw:"N/A",exchange:c.fullExchangeName,dividendDate:l.calendarEvents.dividendDate&&l.calendarEvents.dividendDate.raw?new Date(1e3*l.calendarEvents.dividendDate.raw):"N/A",industry:l.assetProfile.industry?l.assetProfile.industry.split("—")[0]:"",priceChange:_.round(l.price.regularMarketChange.raw,2),priceChangePercentage:100*l.price.regularMarketChangePercent.raw,priceChangeDisplay:"",marketTime:c.regularMarketTime.raw,lastPrice:l.price.regularMarketPreviousClose.raw,dailyHigh:l.price.regularMarketDayHigh.raw,dailyLow:l.price.regularMarketDayLow.raw,dailyVolume:l.price.regularMarketVolume.raw,sector:l.assetProfile.sector,fiftyTwoWeekLow:l.summaryDetail.fiftyTwoWeekLow.raw,fiftyTwoWeekHigh:l.summaryDetail.fiftyTwoWeekHigh.raw,fiftyDayAverage:l.summaryDetail.fiftyDayAverage.raw,twoHundredDayAverage:l.summaryDetail.twoHundredDayAverage.raw,trailingEPS:l.defaultKeyStatistics.trailingEps.raw,epsForecast:l.defaultKeyStatistics.forwardEps.raw,exDividendDate:(m=l,m.summaryDetail.exDividendDate&&m.summaryDetail.exDividendDate.raw?new Date(1e3*m.summaryDetail.exDividendDate.raw):"N/A"),grossProfitGrowth:100*(l.incomeStatementHistory.incomeStatementHistory[0].grossProfit.raw-l.incomeStatementHistory.incomeStatementHistory[1].grossProfit.raw)/l.incomeStatementHistory.incomeStatementHistory[1].grossProfit.raw,netProfitGrowth:100*(l.incomeStatementHistory.incomeStatementHistory[0].netIncome.raw-l.incomeStatementHistory.incomeStatementHistory[1].netIncome.raw)/l.incomeStatementHistory.incomeStatementHistory[1].netIncome.raw,netIncomeMargin:100*_.sumBy(l.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.netIncome.raw))/_.sumBy(l.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.totalRevenue.raw)),dividendsPerShare:l.summaryDetail.dividendRate.raw,dividendRate:0,dividendYield:l.summaryDetail.dividendYield&&_.isNumber(l.summaryDetail.dividendYield.raw)?100*l.summaryDetail.dividendYield.raw:"N/A",totalRevenue:_.sumBy(l.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.totalRevenue.raw)),costOfGoods:_.sumBy(l.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.costOfRevenue.raw)),operatingIncome:_.sumBy(l.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.operatingIncome.raw)),grossProfit:_.sumBy(l.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.grossProfit.raw)),totalCash:e(l),totalCurrentAssets:t(l),totalCurrentLiabilities:n(l),totalAssets:o(l),totalLiabilities:i(l),totalStockholderEquity:a(l),percentFall:"N/A",discountFrom52WeekHigh:"N/A",earningsYield:"N/A",revenueForecast:"N/A",netIncomeForecast:"N/A",roe:"N/A",freeCashFlowYield:"N/A",totalShareHolder:"N/A",dividendGrowthRate:"N/A",dividendMeanForecast:"N/A",dividendPayoutRatio:"N/A",dividendFrequency:"N/A",grossMargin:"N/A",operatingMargin:"N/A",zscore:"N/A",total1YearExcess:"N/A",currentAssetsPerLiabilities:"N/A",totalAssetsPerLiabilities:"N/A",debtEquityRatio:"N/A",oneYearAdjRatio:"N/A",peDiscount:"N/A",peterLynchEstimator:"N/A",costOfGoodsMargin:"N/A",payoutRatio:100*l.summaryDetail.payoutRatio.raw,beta:l.summaryDetail.beta.raw,pre_price:l.price.preMarketPrice?l.price.preMarketPrice.raw:void 0,pre_price_change:l.price.preMarketChange?l.price.preMarketChange.raw:void 0,pre_percent_change:l.price.preMarketChangePercent?l.price.preMarketChangePercent.raw:void 0,pre_market_time:l.price.preMarketTime?l.price.preMarketTime:void 0};var m;u.percentFall=u.fiftyTwoWeekLow?100*(u.fiftyTwoWeekHigh-u.fiftyTwoWeekLow)/u.fiftyTwoWeekLow:"N/A",u.discountFrom52WeekHigh=u.fiftyTwoWeekHigh?100*(u.fiftyTwoWeekHigh-u.currentStockPrice)/u.fiftyTwoWeekHigh:"N/A",u.earningsYield=1/u.trailingPE*100;try{u.roe=100*(Math.pow(l.incomeStatementHistory.incomeStatementHistory[0].netIncome.raw/l.balanceSheetHistory.balanceSheetStatements[0].totalStockholderEquity.raw/(l.incomeStatementHistory.incomeStatementHistory[3].netIncome.raw/l.balanceSheetHistory.balanceSheetStatements[3].totalStockholderEquity.raw),1/3)-1)}catch(e){console.log(e),u.roe="N/A"}return u.freeCashFlowYield=function(e,t){let n=_.sumBy(e.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.totalCashFromOperatingActivities?e.totalCashFromOperatingActivities.raw:0));return n+=_.sumBy(e.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.capitalExpenditures?e.capitalExpenditures.raw:0)),e.defaultKeyStatistics.sharesOutstanding?(n/=e.defaultKeyStatistics.sharesOutstanding.raw,_.round(100*n/t.currentStockPrice,2)):"N/A"}(l,u),u.totalShareHolder=function(e,t){let n=0,o=0;return t.dividendsPerShare>0&&(o=_.sumBy(e.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.dividendsPaid?e.dividendsPaid.raw:0)),n-=o),o=_.sumBy(e.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.repurchaseOfStock?e.repurchaseOfStock.raw:0)),n-=o,o=_.sumBy(e.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.issuanceOfStock?e.issuanceOfStock.raw:0)),n-=o,n=100*n/t.marketCap,n}(l,u),u.dividendMeanForecast=u.dividendsPerShare*(1+u.dividendGrowthRate),u.dividendPayoutRatio=u.dividendsPerShare<=0?0:-100*_.sumBy(l.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.dividendsPaid?e.dividendsPaid.raw:0))/(_.sumBy(l.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.totalCashFromOperatingActivities?e.totalCashFromOperatingActivities.raw:0))+_.sumBy(l.cashflowStatementHistoryQuarterly.cashflowStatements,(e=>e.capitalExpenditures?e.capitalExpenditures.raw:0))),u.grossMargin=_.round(100*(u.totalRevenue-u.costOfGoods)/u.totalRevenue,2),u.operatingMargin=_.round(100*u.operatingIncome/u.totalRevenue,2),u.total1YearExcess=u.totalCurrentAssets-u.totalCurrentLiabilities,u.currentAssetsPerLiabilities=_.round(u.totalCurrentAssets/u.totalCurrentLiabilities,2),u.totalAssetsPerLiabilities=_.round(u.totalAssets/u.totalLiabilities,2),u.debtEquityRatio=u.totalLiabilities/u.totalStockholderEquity,u.oneYearAdjRatio=l.earningsHistory?u.currentStockPrice/_.sumBy(l.earningsHistory.history,(e=>e.epsActual.raw)):"N/A",u.peDiscount=(u.currentPE-u.oneYearAdjRatio)/u.oneYearAdjRatio*-100,u.costOfGoodsMargin=_.round(100*u.costOfGoods/u.totalRevenue,2),u.peterLynchEstimator=function(e,t){let n=t.trailingEPS,o=t.currentStockPrice,i=100*function(e){if(!e.earnings)return"N/A";let t=e.earnings.financialsChart.yearly;if(t.length<=1)return"N/A";var n=parseFloat(t[0].earnings.raw),o=parseFloat(t[t.length-1].earnings.raw);return Math.abs(o/n)**(1/(t.length-1))-1}(e)*n/o;return i<.9?"Overvalued":i<=1.1?"Near Value":"Undervalued"}(l,u),u.zscore=function(e,t){let n=t.total1YearExcess/t.totalAssets*1.2;if(e.balanceSheetHistoryQuarterly.balanceSheetStatements){let o=0;_.each(e.balanceSheetHistoryQuarterly.balanceSheetStatements,(e=>{if(e.retainedEarnings)return o=e.retainedEarnings.raw,!1})),n+=o/t.totalAssets*1.4}return n+=_.sumBy(e.incomeStatementHistoryQuarterly.incomeStatementHistory,(e=>e.ebit?e.ebit.raw:0))/t.totalAssets*3.3,n+=t.marketCap/t.totalLiabilities*.6,n+=t.totalRevenue/t.totalAssets*1,n}(l,u),u.dividendFrequency=function(e){e=e.chart.result[0];let t=[],n=0;try{t=e.events.dividends}catch(e){console.log("No dividend paid data")}let o=(a=new Date,r=a.getUTCDate()+1,s=a.getUTCMonth(),c=a.getUTCFullYear(),Date.UTC(c-1,s,r)/1e3),i=_.filter(t,(e=>e.date>o));var a,r,s,c;n=_.size(i);var l="";switch(n){case 0:l="Growth";break;case 1:l="Annually";break;case 2:l="Semi-annually";break;case 4:l="Quarterly";break;case 12:l="Monthly";break;default:l=n.toString()}return l}(d),u.dividendGrowthRate=function(e){let t=e[0],n=e[1],o=0,i=0,a=0;try{o=_.sumBy(_.map(t.chart.result[0].events.dividends,(e=>e.amount))),i=_.sumBy(_.map(n.chart.result[0].events.dividends,(e=>e.amount)))}catch(e){console.log("No dividend paid data")}return a=i>0?100*(o-i)/i:0,a}(d),u.dividendMeanForecast=u.dividendsPerShare*(1+u.dividendGrowthRate/100),u.revenueForecast=function(e){if(!e.earningsTrend)return"N/A";let t=_.find(e.earningsTrend.trend,(e=>"+1y"==e.period));return t?100*t.revenueEstimate.growth.raw:"N/A"}(l),u.netIncomeForecast=function(e){if(!e.earningsTrend)return"N/A";let t=_.find(e.earningsTrend.trend,(e=>"+5y"==e.period));return t?100*t.growth.raw:"N/A"}(l),u.priceChangeDisplay=function(e){var t="",n="|";e.priceChange<0?(t="text-danger",n="▼"):e.priceChange>0&&(t="text-success",n="▲");let o=`<span class="${t}">${e.currentStockPrice} ${n} ${e.priceChange} (${_.round(e.priceChangePercentage,2)}%)</span>`;if(e.marketTime){let t=Intl.DateTimeFormat().resolvedOptions().timeZone;o=`${o}<small class="d-block">Closed at ${moment(1e3*e.marketTime).tz(t).format("MMM DD H:mm a z")}</small>`}return o}(u),u.dividendRate=function(e){let t=e.dividendsPerShare;switch(e.dividendFrequency.toLowerCase()){case"monthly":t=e.dividendsPerShare/12;break;case"quarterly":t=e.dividendsPerShare/4;break;case"annually":break;case"semi-annually":t=e.dividendsPerShare/2;break;default:try{const n=parseInt(e.dividendFrequency);t=isNaN(n)||0===n?e.dividendsPerShare:e.dividendsPerShare/n}catch(n){t=e.dividendsPerShare}}return t}(u),u},parsePriceChangeDisplay:r,parseInfo:function(e){const t=e.quoteData[e.symbol],n=e.price;let o={code:e.symbol,name:t.shortName,exchange:t.fullExchangeName,price:t.regularMarketPrice.raw,price_change:t.regularMarketChange.raw,percent_change:t.regularMarketChangePercent.raw,last_price:t.regularMarketPreviousClose.raw,daily_high:t.regularMarketDayHigh.raw,daily_low:t.regularMarketDayLow.raw,volume:t.regularMarketVolume.raw,market_time:t.regularMarketTime.raw,currency:t.currency,fiftytwo_week_high:t.fiftyTwoWeekHigh.raw,fiftytwo_week_low:t.fiftyTwoWeekLow.raw,pre_price:n.preMarketPrice?n.preMarketPrice.raw:void 0,pre_price_change:n.preMarketChange?n.preMarketChange.raw:void 0,pre_percent_change:n.preMarketChangePercent?n.preMarketChangePercent.raw:void 0,pre_market_time:n.preMarketTime?n.preMarketTime:void 0};return o.prePriceChangeDisplay=o.pre_price?r(o,"pre"):"",o.priceChangeDisplay=o.price?r(o):"",o},getCloseTime:function(e,t,n){n||(n="current");let o=e.market_time;if("pre"==n&&(o=e.pre_market_time),o){_format="",t&&(_format="MMM DD "),_format+="H:mm a z";let e=Intl.DateTimeFormat().resolvedOptions().timeZone;return`${moment(1e3*o).tz(e).format(_format)}`}return""}}}angular.module("fm").factory("StockParser",e),e.$inject=[]})(),angular.module("fm").factory("Databank",["$http","AppConfig",function(e,t){var n=t.API_PREFIX;return{getAll:function(t){return console.log("[Databank] getAll()"),t=_.extend({},t),e.get(n+"stock/databanks/",{params:t}).then((function(e){return e.data}))},update:function(t,o){return e.put(`${n}stock/databanks/${t}/`,o)},partialUpdate:function(t,o){return e.patch(`${n}stock/databanks/${t}/`,o)},create:function(t){return e.post(`${n}stock/databanks/`,t)},remove:function(t,o){return e.delete(`${n}stock/databanks/${t}/`)},sectors:function(){return e.get(`${n}stock/databanks/sectors/`)},industries:function(){return e.get(`${n}stock/databanks/industries/`)}}}]),angular.module("fm").factory("Screener",["$http","AppConfig",function(e,t){var n=t.API_PREFIX;return{getAll:function(t){return console.log("[Databank] getAll()"),t=_.extend({},t),e.get(n+"stock/screeners/",{params:t}).then((function(e){return e.data}))},update:function(t,o){return e.put(`${n}stock/screeners/${t}/`,o)},partialUpdate:function(t,o){return e.patch(`${n}stock/screeners/${t}/`,o)},create:function(t){return e.post(`${n}stock/screeners/`,t)},remove:function(t){return e.delete(`${n}stock/screeners/${t}/`)},sectors:function(){return e.get(`${n}stock/screeners/sectors/`)},industries:function(){return e.get(`${n}stock/screeners/industries/`)}}}]),angular.module("fm").factory("Watchlist",["$http","AppConfig",function(e,t){var n=t.API_PREFIX;return{getAll:function(t){return console.log("[Databank] getAll()"),t=_.extend({},t),e.get(n+"stock/watchlists/",{params:t}).then((function(e){return e.data}))},update:function(t,o){return e.put(`${n}stock/watchlists/${t}/`,o)},partialUpdate:function(t,o){return e.patch(`${n}stock/watchlists/${t}/`,o)},create:function(t){return e.post(`${n}stock/watchlists/`,t)},remove:function(t,o){return e.delete(`${n}stock/watchlists/${t}/`)}}}]),angular.module("fm").factory("StockList",["$http","AppConfig",function(e,t){var n=t.API_PREFIX;return{getAll:function(t){return console.log("[StockList] getAll()"),t=_.extend({},t),e.get(n+"stock/stock_lists/",{params:t}).then((function(e){return e.data}))},update:function(t,o){return e.put(`${n}stock/stock_lists/${t}/`,o)},partialUpdate:function(t,o){return e.patch(`${n}stock/stock_lists/${t}/`,o)},create:function(t){return e.post(`${n}stock/stock_lists/`,t)},remove:function(t,o){return e.delete(`${n}stock/stock_lists/${t}/`)}}}]),angular.module("fm").factory("DividendService",["$rootScope",function(e){function t(e,t){let n={numberOfShare:e.numberOfShare||0,investmentCash:e.numberOfShare*e.currentStockPrice+t.commission,investmentCashDrip:e.numberOfShare*e.currentStockPrice+t.commission,cashBalance:t.balance-(e.numberOfShare*e.currentStockPrice+t.commission),year:1,newYear:!0,endYear:!1,title:"Year 1",dripShare:0,yearEarning:0,yearEarningDrip:0,dripShareInYear:0,profit:0,profitDrip:0,upToNowEarning:0,upToNowEarningDrip:0,currentStockPrice:e.currentStockPrice};return n.cashBalance=t.init_amount-n.investmentCash,n.averageCost=n.investmentCash/n.numberOfShare,n}return{estimateDividend:function(e,n){let o=[],i=t(e,n),a={monthly:12,quarterly:4,annually:1,"semi-annually":2,growth:0}[(""+(r=e).dividendFrequency).toLowerCase()]||r.dividendFrequency;var r;let s=function(e){return{monthly:"M",quarterly:"Q",annually:"","semi-annually":"S",growth:"",3:"#",5:"#",6:"#",7:"#",8:"#",9:"#",10:"#",11:"#"}[(""+e.dividendFrequency).toLowerCase()]||""}(e);for(let t=1;t<n.year*a;t++){let n=Math.floor(t/a)+1,r=1==t?i:o[t-2],c=e.numberOfShare*e.dividendsPerShare,l=r.numberOfShare*e.dividendsPerShare,d=Math.floor(l/e.currentStockPrice),u={dividendCash:c,dripShare:d,numberOfShare:r.numberOfShare+d,investmentCash:r.investmentCash+c,investmentCashDrip:0,sharePecentageCash:_.round(c%e.currentStockPrice/e.currentStockPrice*100,2),cashBalance:r.cashBalance+(c/e.currentStockPrice-d)*e.currentStockPrice,dividendCashDrip:0,year:n,newYear:!1,endYear:!1,title:`Year ${n}`};u.dripShareInYear=r.dripShareInYear+u.dripShare,u.dividendCashDrip=(r.numberOfShare*e.dividendsPerShare/e.currentStockPrice-d)*e.currentStockPrice,u.cashDripReceive=_.round(u.dripShare*e.currentStockPrice,2),u.investmentCashDrip=u.cashDripReceive+r.investmentCashDrip+u.dividendCashDrip,""!=s&&(u.title+=` - ${s}${t%a+1}`),u.dividendShort=`Year ${u.year} - ${s}${t%a+1}`,u.yearEarning=r.yearEarning+u.dividendCash,u.yearEarningDrip=r.yearEarningDrip+u.dividendCashDrip,u.upToNowEarning=r.upToNowEarning+u.dividendCash,u.upToNowEarningDrip=r.upToNowEarningDrip+u.dividendCashDrip,u.profit=100*(u.investmentCash-i.investmentCash)/i.investmentCash,u.profitDrip=100*(u.investmentCashDrip-i.investmentCash)/i.investmentCash,t>0&&n>r.year&&(u.newYear=!0,r.endYear=!0,u.dripShareInYear=u.dripShare,u.yearEarning=u.dividendCash,u.yearEarningDrip=u.dividendCashDrip),o.push(u)}return o[o.length-1].endYear=!0,o},getInitDividend:t,transformDividendsPerShare:function(e){switch(e.dividendFrequency.toLowerCase()){case"monthly":e.dividendsPerShare=e.dividendsPerShare/12;break;case"quarterly":e.dividendsPerShare=e.dividendsPerShare/4;break;case"annually":break;case"semi-annually":e.dividendsPerShare=e.dividendsPerShare/2;break;default:try{const t=parseInt(e.dividendFrequency);isNaN(t)||0===t?e.dividendsPerShare=e.dividendsPerShare:e.dividendsPerShare=e.dividendsPerShare/t}catch(e){}}return e.dividendsPerShare&&(e.dividendsPerShare=e.dividendsPerShare.toFixed(3)),e},generateYears:function(e,t){e=e||40;let n=[1];for(let o=t=t||1;o<=e;o+=t)1!==o&&n.push(o);return console.log(n),n}}}]),function(){"use strict";function e(e,t,n){return{goto:function(e){var o=e;t.hash()!==o?(t.hash(e),n(),t.hash(null)):n()}}}angular.module("fm").factory("AnchorService",e),e.$inject=["$rootScope","$location","$anchorScroll"]}(),function(){"use strict";function e(e){return{send:function(t,n){e.$broadcast(t,n)},on:function(t,n){e.$on(t,n)}}}angular.module("fm").factory("Broadcast",e),e.$inject=["$rootScope"]}(),angular.module("fm").factory("BuyStockService",["$rootScope","$q",function(e,t){var n=this;return e.$on("BUY_STOCK_CONFIRM",(e=>{n.defer.resolve()})),{show:function(o,i,a,r){return console.log("[BuyStockService] show()"),n.defer=t.defer(),e.$broadcast("BUY_STOCK_SHOW",o,i,a,r),n.defer.promise}}}]),angular.module("fm").factory("SellStockService",["$rootScope","$q",function(e,t){var n=this;return e.$on("SELL_STOCK_CONFIRM",(e=>{n.defer.resolve()})),{show:function(o,i){return console.log("[SellStockService] show()"),n.defer=t.defer(),e.$broadcast("SELL_STOCK_SHOW",o,i),n.defer.promise}}}]),angular.module("fm").factory("Portfolio",["$http","AppConfig",function(e,t){var n=t.API_PREFIX;return{getAll:function(t){return console.log("[Portfolio] getAll()"),t=_.extend({},t),e.get(n+"stock/portfolios/",{params:t}).then((function(e){return e.data}))},update:function(t,o){return e.put(`${n}stock/portfolios/${t}/`,o)},create:function(t){return e.post(`${n}stock/portfolios/`,t)},remove:function(t){return e.delete(`${n}stock/portfolios/${t}/`)},withdraw:function(t,o){return e.post(`${n}stock/portfolios/${t}/withdraw_balance/`,o)},addBalance:function(t,o){return e.post(`${n}stock/portfolios/${t}/add_balance/`,o)}}}]),function(){"use strict";function e(e,t,n,o){return{restrict:"E",templateUrl:"views/fm-budget.html",scope:{budget:"=",callback:"="},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope",function(o){let i=this;function a(){i.budget.expense.items.length&&e((()=>{b()}),100)}function r(e){i.budget.editing=!1,n.updateBudget(e.id,e).then((({data:t})=>{let n=!1;i.budget.pie_title!=e.pie_title&&(n=!0),i.budget.name=t.name,i.budget.pie_title=t.pie_title,console.log("[budget.directive.js] saveBudget then"),n&&b()}))}function s(e){i.budget.editing=!1,n.deleteBudget(e.id).then((()=>{console.log("[budget.directive.js] deleteBudget then"),o.callback&&o.callback.deleteBudget&&o.callback.deleteBudget(e)}))}function c(e){n.copyBudget(e.id).then((({data:t})=>{console.log("[budget.controller.js] addBudget then",t),o.callback&&o.callback.addBudget&&o.callback.addBudget(t,e.id)}))}function l(){i.budgetEdit=_.clone(i.budget),i.budget.editing=!0}function d(){let e=["css/app.css","libs/bootstrap.min.css","css/printjs.css"];ENV&&"production"==ENV&&(e=["/app.min.css","css/bootstrap.min.css","css/printjs.css"]),printJS({printable:"b_"+i.budget.id,type:"html",css:e,maxWidth:"1024px",targetStyles:["*"]})}function u(e){let t=_.findIndex(i.budget.expense.items,["ref_category",e.id]);t>=0&&i.budget.expense.items.splice(t,1),_.remove(i.budget.categories,["id",e.id])}function m(t){let n={id:`c_${Math.random()}`,name:"",budget:i.budget.id,editing:!0,items:[]};if(!t)return n.order=1,void i.budget.categories.unshift(n);n.order=t.order;let o=_.findIndex(i.budget.categories,["id",t.id]);o<0?i.budget.categories.push(n):e((()=>{i.budget.categories.splice(o+1,0,n)}))}function f(t,n){g(n),e((()=>{y(),b()}),20),o.$broadcast("EXPENSE_REFRESH",{})}function h(t,n){g(n),e((()=>{y(),b()}),20),o.$broadcast("EXPENSE_REFRESH",{})}function g(e){let t=_.findIndex(i.budget.expense.items,["ref_category",e.id]);if(t<0)return;i.budget.expense.items[t].weekly=e.total_weekly,i.budget.expense.items[t].bi_weekly=e.total_bi_weekly,i.budget.expense.items[t].monthly=e.total_monthly,i.budget.expense.items[t].yearly=e.total_yearly;let o=_.find(i.budget.expense.items,["ref_category",e.id]);o&&n.updateItem(o.id,o).then((()=>{console.log("[budget.directive.js] updateItem then")}))}function p(e){let t=_.find(i.budget.expense.items,["ref_category",e.id]);if(t)return void(t.name=e.name);let o={name:e.name,ref_category:e.id,category:i.budget.expense.id};n.createItem(o).then((({data:e})=>{o.id=e.id,i.budget.expense.items.push(o)}))}function y(){i.budget.surplus_weekly=i.budget.income.total_weekly-i.budget.expense.total_weekly,i.budget.surplus_bi_weekly=i.budget.income.total_bi_weekly-i.budget.expense.total_bi_weekly,i.budget.surplus_monthly=i.budget.income.total_monthly-i.budget.expense.total_monthly,i.budget.surplus_yearly=i.budget.income.total_yearly-i.budget.expense.total_yearly}function v(e,t){let n=e.toLocaleString(void 0,{minimumFractionDigits:2});return t&&(n=t+n),n}function b(){let e=[],n=_.sumBy(i.budget.expense.items,"monthly")||0;_.each(i.budget.expense.items,((t,o)=>{let i=_.round(t.monthly,2),a=_.round(100*t.monthly/n,2);i=v(i,"$"),e.push([t.name,i,a,`${t.percentage}%`])})),n=v(n);let o=i.budget.pie_title;o||(o=`${i.budget.created_by.first_name||i.budget.created_by.username}'s Typical<br>Monthly Budget<br>`),o=`<span style='fill: #fff; font-size: 1.2rem; font-weight: 600;'>${o}<br/><span style='fill: #22c9e4; font-size: 1.6rem; font-weight: 1000;'>$${n}</span> </span>`;let a=i.budget.title;t.draw3DDonut(`chartContainer-${i.budget.id}`,e,{title:o,subTitle:a})}function k(e){i.totalNetAsset=e,w()}function S(e){i.totalLiability=e,w()}function w(){i.assetPerLiability=i.totalNetAsset-i.totalLiability}console.log("[fmBudget] activate"),i.budget=o.budget,i.assetPerLiability=0,i.categoryCallback={},i.netAssetCallback={onTotalChange:k},i.liabilityCallback={onTotalChange:S},i.categoryCallback.deleteCategory=u,i.categoryCallback.saveItem=f,i.categoryCallback.deleteItem=h,i.categoryCallback.saveCategory=p,i.categoryCallback.categoryReady=a,i.categoryCallback.addCategory=m,i.addCategory=m,i.saveBudget=r,i.deleteBudget=s,i.addBudget=c,i.editBudget=l,i.printBudget=d,o.$watch("budget",((t,n)=>{t&&n&&(i.budget=t,e((()=>{b()}),100))})),i.totalNetAsset=0,i.totalLiability=0}]}}angular.module("fm").directive("fmBudget",e),e.$inject=["$timeout","ChartService","ApiService","ConfirmService"]}(),function(){"use strict";function e(e,t,n,o,i,a,r){return{restrict:"E",templateUrl:"views/fm-debt.html",scope:{debt:"=",callback:"="},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope",function(i){let s=this;function c(){}function l(){let e=new Date,n=Intl.DateTimeFormat().resolvedOptions().timeZone,o=moment().tz(n);return`${t("date")(e,"MMM d, y hh:mm a")} ${o.format("z")}`}function d(e){s.debt.editing=!1,a.updateDebt(e.id,_.pick(e,["name","d_type"])).then((()=>{console.log("[debt.directive.js] saveDebt then"),v()}))}function u(e){r.show().then((()=>{a.deleteDebt(e.id).then((()=>{console.log("[debt.directive.js] deleteDebt then"),i.callback&&i.callback.deleteDebt&&i.callback.deleteDebt(e)}))}))}function m(e){_.remove(s.debt.expenses,["id",e.id]),y(),v()}function f(){s.debt.expenses.push({id:`c_${Math.random()}`,name:"",debt:s.debt.id,editing:!0,items:[]})}function h(e,t){y(),v()}function g(e,t){y(),v()}function p(e){e.items.length||s.debt.expense.items.push(newExpenseItem)}function y(){let e=_.sumBy(s.debt.expenses,"total"),t=_.sumBy(s.debt.incomes,"total"),n=_.sumBy(s.debt.liabilities,"total");s.debt.totalIncomes=t,s.debt.totalExpenses=e,s.debt.totalLiabilities=n,s.debt.gds=_.round((e+n)/t*100,2)||0,s.debt.tds=s.debt.gds}function v(){let e=`ChartContainer-${s.debt.id}`,t=32,n="Gross Debt Service Ratio";2==s.debt.d_type&&(t=40,n="Total Debt Service Ratio"),o.drawProgress(e,s.debt.gds,{standard:t,title:n})}function b(){let e=["css/app.css","libs/bootstrap.min.css","css/printjs.css"];ENV&&"production"==ENV&&(e=["/app.min.css","css/bootstrap.min.css","css/printjs.css"]),printJS({printable:"d_"+s.debt.id,type:"html",css:e,maxWidth:"1024px",targetStyles:["*"]})}console.log("[fmDebt] activate"),s.debt=i.debt,s.categoryCallback={},s.categoryCallback.deleteCategory=m,s.categoryCallback.saveCategory=p,s.categoryCallback.categoryReady=c,s.addCategory=f,s.categoryCallback.saveItem=h,s.categoryCallback.deleteItem=g,s.saveDebt=d,s.deleteDebt=u,s.printDebt=b,y(),e((()=>{v()}),20),s.debt.time=l(),n((()=>{s.debt.time=l()}),6e4)}]}}angular.module("fm").directive("fmDebt",e),e.$inject=["$timeout","$filter","$interval","ChartService","ApiService","DebtApi","ConfirmService"]}(),function(){"use strict";function e(e,t,n){return{restrict:"E",templateUrl:"views/fm-category.html",scope:{category:"=",callback:"="},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope",function(o){let i=this;function a(e){n.show().then((()=>{_.remove(i.category.items,["id",e.id]),d(),o.callback&&o.callback.deleteItem&&o.callback.deleteItem.call(null,e,i.category),"number"==typeof e.id&&t.deleteItem(e.id).then((()=>{console.log("[category.directive] deleteCategory then")}))}))}function r(){i.category.items.push({id:`i_${Math.random()}`,name:"",category:i.category.id,editing:!0}),i.rowEditing=!0}function s(e){e.bi_weekly=_.round(e.monthly/2,2),e.weekly=_.round(e.monthly/4,2),e.yearly=_.round(12*e.monthly,2),d()}function c(e){n.show().then((()=>{o.callback&&o.callback.deleteCategory&&o.callback.deleteCategory.call(null,i.category),"number"==typeof e.id&&t.deleteCategory(e.id).then((()=>{console.log("[category.directive] deleteCategory then")}))}))}function l(e){if(13!=e.code)return!0}function d(){i.category.total_weekly=0,i.category.total_bi_weekly=0,i.category.total_monthly=0,i.category.total_yearly=0,_.each(i.category.items,((e,t)=>{i.category.total_weekly+=e.weekly,i.category.total_bi_weekly+=e.bi_weekly,i.category.total_monthly+=e.monthly,i.category.total_yearly+=e.yearly}))}function u(e){if(!e.name||""==e.name)return;e.editing=!1;let n=null;n="string"==typeof e.id&&e.id.indexOf("c_")>=0?t.createCategory({id:void 0,...e}):t.updateCategory(e.id,e),n.then((({data:t})=>{console.log("[category.directive] saveCategory then"),e.id=t.id,e.c_type=t.c_type,e.items.length||r(),!e.persistent&&o.callback&&o.callback.saveCategory&&o.callback.saveCategory.call(null,e)}))}function m(n){if(!n.name||""==n.name||void 0===n.monthly)return;let a=null;n.monthly=_.round(n.monthly,2),a="string"==typeof n.id&&n.id.indexOf("i_")>=0?t.createItem({id:void 0,...n}):t.updateItem(n.id,n),n.editing=!1,i.rowEditing=!1,a.then((({data:t})=>{console.log("[category.directive] saveItem then"),n.id=t.id,e((()=>{o.callback&&o.callback.saveItem&&o.callback.saveItem.call(null,n,i.category),2==i.category.c_type&&f()}),50)}))}function f(){_.each(i.category.items,((e,t)=>{e.percentage=_.round(e.monthly/i.category.total_monthly*100,2)}))}function h(t){t.zero=!t.zero,t.zero?(t.monthly_bak=t.monthly,t.monthly=0):t.monthly=t.monthly_bak,s(t),e((()=>{o.callback&&o.callback.saveItem&&o.callback.saveItem.call(null,t,i.category),2==i.category.c_type&&f()}),50)}function g(e){o.callback.addCategory&&o.callback.addCategory(e)}function p(e){const n=_.findIndex(i.category.items,(t=>t.id==e.id));if(n<0)return;if(n>=i.category.items.length-1)return;const o=i.category.items[n];i.category.items[n]=i.category.items[n+1],i.category.items[n+1]=o,t.itemDown(e.id).then((()=>{console.log("Item moved down")}))}function y(e){const n=_.findIndex(i.category.items,(t=>t.id==e.id));if(n<=0)return;if(n>i.category.items.length-1)return;const o=i.category.items[n];i.category.items[n]=i.category.items[n-1],i.category.items[n-1]=o,t.itemUp(e.id).then((()=>{console.log("Item moved up")}))}console.log("[fmCategory] activate"),i.rowEditing=!1,i.category=o.category,i.deleteItem=a,i.addItem=r,i.calculateNet=s,i.deleteCategory=c,i.monthlyNetKeyPress=l,i.calculateTotal=d,i.saveCategory=u,i.saveItem=m,i.setZero=h,i.addCategory=g,i.itemMoveUp=y,i.itemMoveDown=p,2==i.category.c_type&&(o.$on("EXPENSE_REFRESH",(()=>{d(),f()})),f(),o.callback&&o.callback.categoryReady&&o.callback.categoryReady.call(null)),o.$watch("category",((e,t)=>{e&&t&&(i.category=e)}))}]}}angular.module("fm").directive("fmCategory",e),e.$inject=["$timeout","ApiService","ConfirmService"]}(),function(){"use strict";function e(e,t,n,o){return{restrict:"E",templateUrl:"views/debt-category.html",scope:{category:"=",callback:"=",cType:"@"},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope",function(e){let t=this;function i(i){o.show().then((()=>{if(_.remove(t.category.items,["id",i.id]),s(),e.callback&&e.callback.deleteItem&&e.callback.deleteItem.call(null,i,t.category),"number"==typeof i.id){let e=null;e="liability"===t.cType?n.deleteLiabilityItem(i.id):n.deleteItem(i.id),e.then((()=>{console.log("[debtCategory.directive] deleteItem then")}))}}))}function a(){t.category.items.push({id:`i_${Math.random()}`,name:"",category:t.category.id,liability:t.category.id,editing:!0})}function r(i){i.persistent||o.show().then((()=>{e.callback&&e.callback.deleteCategory&&e.callback.deleteCategory.call(null,t.category),"number"==typeof i.id&&n.deleteCategory(i.id).then((()=>{console.log("[debtCategory.directive] deleteCategory then")}))}))}function s(){t.category.total=_.sumBy(t.category.items,"amount")}function c(o){if(!o.name||""==o.name)return;o.editing=!1;let i=null;i="string"==typeof o.id&&o.id.indexOf("c_")>=0?"liability"===t.cType?n.createLiability({id:void 0,...o}):n.createCategory({id:void 0,...o}):"liability"===t.cType?n.updateLiability(o.id,o):n.updateCategory(o.id,o),i.then((({data:t})=>{console.log("[debtCategory.directive] saveCategory then"),o.id=t.id,o.items.length||a(),!o.persistent&&e.callback&&e.callback.saveCategory&&e.callback.saveCategory.call(null,o)}))}function l(o){if(!o.name||""==o.name||void 0===o.amount)return;o.amount=_.round(o.amount,2);let i=null;i="string"==typeof o.id&&o.id.indexOf("i_")>=0?"liability"===t.cType?n.createLiabilityItem({id:void 0,...o}):n.createItem({id:void 0,...o}):"liability"===t.cType?n.updateLiabilityItem(o.id,o):n.updateItem(o.id,o),o.editing=!1,i.then((({data:n})=>{console.log("[debtCategory.directive] saveItem then"),o.id=n.id,e.callback&&e.callback.saveItem&&e.callback.saveItem.call(null,o,t.category)}))}console.log("[debtCategory] activate"),t.category=e.category,t.cType=e.cType||"",t.deleteItem=i,t.addItem=a,t.deleteCategory=r,t.calculateTotal=s,t.saveCategory=c,t.saveItem=l}]}}angular.module("fm").directive("debtCategory",e),e.$inject=["$timeout","ApiService","DebtApi","ConfirmService"]}(),function(){"use strict";angular.module("fm").directive("autoFocus",["$timeout",function(e){return{link:function(t,n,o){o.$observe("autoFocus",(function(t){"true"===t&&e((function(){n[0].focus()}))}))}}}])}(),function(){"use strict";function e(){return{restrict:"E",template:' \n<div class="modal d-block" ng-if="vm.show">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title">{{ vm.options.title }}</h5>\n        <button type="button" class="close" ng-click="vm.show=false">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <p>{{ vm.options.content }}</p>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" ng-click="vm.show=false">Close</button>\n        <button type="button" class="btn {{ vm.options.confirmBtnClass }}" ng-click="vm.onConfirm()">\n          <i class="material-icons">{{ vm.options.confirmBtnIcon }}</i>\n          {{ vm.options.confirmBtn }}\n        </button>  \n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<div class="modal-backdrop fade show" ng-if="vm.show"></div>\n      ',scope:{},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope","$rootScope",function(e,t){let n=this;var o={title:"Delete Confirm",content:"Do you want to delete this?",confirmBtnClass:"btn-danger",confirmBtnIcon:"delete",confirmBtn:"Delete"};function i(){n.show=!1,t.$broadcast("CONFIRM_MODAL_CONFIRM")}console.log("[confirmModal] activate"),n.show=!1,n.options={},n.onConfirm=i,e.$on("CONFIRM_MODAL_SHOW",((e,t)=>{n.show=!0,t=t||{},n.options=_.extend(o,t)}))}]}}angular.module("fm").directive("confirmModal",e),e.$inject=[]}(),function(){"use strict";function e(){return{restrict:"E",template:' \n<div class="position-fixed right-0 p-3" style="z-index: 5; right: 0px; top: 20px;" ng-if="vm.show">\n  <div class="toast fm-toast {{ vm.options.borderClass }}" role="alert">\n    <div class="toast-header bg-white">\n      <div class="bd-placeholder-img rounded mr-2 {{ vm.options.bgClass }}" style="width:20px;height:20px"></div>\n      <strong class="mr-auto">{{ vm.options.title }}</strong>\n      <small></small>\n      <button type="button" class="ml-2 mb-1 close" ng-click="vm.closeToast()">\n        <span aria-hidden="true">&times;</span>\n      </button>\n    </div>\n    <div class="toast-body">\n      {{ vm.options.body }}\n    </div>\n  </div>\n</div>\n      ',scope:{},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope","$rootScope","$timeout",function(e,t,n){let o=this;var i={autoClose:5e3};let a=null;function r(){o.show=!1,t.$broadcast("TOAST_CLOSE")}console.log("[confirmModal] activate"),o.show=!1,o.options={},o.closeToast=r,e.$on("TOAST_SHOW",((e,t)=>{o.show&&(n.cancel(a),r()),o.options=_.extend(t||{},i),"number"!=typeof o.options.autoClose&&(o.options.autoClose=5e3),o.options.autoClose&&(a=n((()=>{r()}),o.options.autoClose)),n((()=>{o.show=!0}))}))}]}}angular.module("fm").directive("toast",e),e.$inject=[]}(),function(){"use strict";angular.module("fm").directive("yearSelector",["$timeout",function(e){return{restrict:"E",template:'\n      <select ng-model="ngModel" class="form-control" \n        ng-options="y for y in vm.yearRange"\n        ng-change="ngChange && ngChange(ngModel)">\n      </select>\n      ',scope:{min:"=",max:"=",ngModel:"=",ngChange:"="},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope",function(e){var t,n,o=this;o.yearRange=[],t=e.min||1,n=e.max||40,function(){for(let e=t;e<=n;e++)o.yearRange.push(e)}()}]}}])}(),function(){"use strict";function e(){return{restrict:"E",template:"\n      <ui-select ng-model='ddModel[ddSubModel]' ng-change='vm.ddChange(ddModel[ddSubModel])' reset-search-input='false' name=\"uiSelectDatabank\" ng-required=\"required\">\n          <ui-select-match placeholder=\"Symbol\" allow-clear=\"true\">\n              {{ $select.selected.code }}\n          </ui-select-match>\n          \n          <ui-select-choices repeat='stock.code as stock in vm.stocks | filter: $select.search'>\n              <div ng-bind-html='stock.code | highlight: $select.search'></div> \n              <small ng-bind-html=\"stock.name | highlight: $select.search\"></small>\n          </ui-select-choices>\n          \n      </ui-select>\n      ",scope:{ddModel:"=",ddSubModel:"@",ddChange:"=",required:"@",ddInit:"@"},link:(e,t,n)=>{e.ddSubModel=e.ddSubModel||"code",e.required="required"===e.required},controller:["$scope","Databank",function(e,t){var n=this;function o(t){if(e.ddChange){let o=_.find(n.stocks,["code",t]);o&&e.ddChange.call(void 0,o)}}n.stocks=[],n.ddChange=o,function(o){let i={page:n.page,page_size:150,ordering:"code"};o&&(i.code=o),t.getAll(i).then((({results:t})=>{if(n.stocks=t,e.ddInit){const t=_.find(n.stocks,(t=>t.id==e.ddInit));t&&(e.ddModel[e.ddSubModel]=t.code)}})).catch((()=>{}))}()}],controllerAs:"vm"}}angular.module("fm").directive("ddDatabank",e),e.$inject=[]}(),function(){"use strict";function e(){return{restrict:"E",template:'\n      <ui-select ng-model=\'ddModel[ddSubModel]\' ng-change=\'vm.ddChange(ddModel[ddSubModel])\' reset-search-input=\'false\' name="uiSelectScreener" ng-required="required">\n          <ui-select-match placeholder="Symbol" allow-clear="true">\n              {{ $select.selected.code }}\n          </ui-select-match>\n          \n          <ui-select-choices repeat=\'stock.code as stock in vm.stocks | filter: $select.search\' refresh=\'vm.getStocks($select.search)\' refresh-delay=\'250\'>\n              <div class="d-flex">\n                <span ng-bind-html=\'stock.code | highlight: $select.search\'></span>\n                <span ng-if="stock.name" class="mx-2">-</span>\n                <span ng-if="stock.name" ng-bind-html="stock.name | highlight: $select.search"></span>\n              </div> \n              \n          </ui-select-choices>\n          \n      </ui-select>\n      ',scope:{ddModel:"=",ddSubModel:"@",ddChange:"=",required:"@"},link:(e,t,n)=>{e.ddSubModel=e.ddSubModel||"code",e.required="required"===e.required},controller:["$scope","Screener",function(e,t){var n=this;let o=!1;function i(e){if(o)return;let i={page:n.page,page_size:50,ordering:"code"};return e&&(i.search=e),t.getAll(i).then((e=>{e.count<=50&&(o=!0),n.stocks=e.results})).catch((()=>{}))}function a(t){if(e.ddChange){let o=_.find(n.stocks,["code",t]);o&&e.ddChange.call(void 0,o)}}n.stocks=[],n.ddChange=a,n.getStocks=i,i()}],controllerAs:"vm"}}angular.module("fm").directive("ddScreener",e),e.$inject=[]}(),function(){"use strict";function e(){return{restrict:"E",template:'\n      <div class="paging d-flex">\n        <div class="">Total: {{ total }}</div>\n        <div class="ml-auto">\n          <span class="mr-2">Showing {{ vm.showing }}</span>\n          <div class="btn-group btn-group-sm">\n            <button type="button" class="btn btn-info" ng-disabled="currentPage===1" ng-click="vm.goBack()">\n              <i class="material-icons">arrow_back_ios</i>\n              <span>Back</span>\n            </button>\n            <button type="button" class="btn btn-info" ng-disabled="currentPage===vm.lastPage" ng-click="vm.goNext()">\n              <span>Next</span>\n              <i class="material-icons">arrow_forward_ios</i>\n            </button>\n          </div>\n        </div>\n      </div>\n      ',scope:{total:"=",pageSize:"=",currentPage:"=",callback:"="},link:(e,t,n)=>{},controller:["$scope",function(e){var t=this;function n(){t.lastPage=Math.ceil(e.total/e.pageSize)}function o(){let n=(e.currentPage-1)*e.pageSize+e.pageSize;n>e.total&&(n=e.total),t.showing=`${(e.currentPage-1)*e.pageSize+1} - ${n}`}function i(){1!==e.currentPage&&e.callback&&e.callback.goBack&&e.callback.goBack()}function a(){e.currentPage!==e.lastPage&&e.callback&&e.callback.goNext&&e.callback.goNext()}t.lastPage=1,t.goBack=i,t.goNext=a,n(),o(),e.$watch("total",((e,t)=>{e!=t&&(n(),o())})),e.$watch("currentPage",((e,t)=>{e!=t&&o()}))}],controllerAs:"vm"}}angular.module("fm").directive("paging",e),e.$inject=[]}(),function(){"use strict";function e(){return{restrict:"E",template:'\n      <ui-select ng-model=\'ddModel[ddSubModel]\' ng-change=\'vm.ddChange(ddModel[ddSubModel])\' reset-search-input=\'false\' name="uiSelectScreener" ng-required="required">\n          <ui-select-match placeholder="{{ placeholder||\'Symbol\' }}" allow-clear="true">\n              {{ $select.selected.symbol }}\n          </ui-select-match>\n          \n          <ui-select-choices repeat=\'stock in vm.stocks | filter: $select.search\' refresh=\'vm.findStocks($select.search)\' refresh-delay=\'250\'>\n              <div class="d-flex">\n                <span ng-bind-html=\'stock.symbol | highlight: $select.search\'></span>\n                <span ng-if="stock.shortname" class="mx-2">-</span>\n                <span ng-if="stock.shortname" ng-bind-html="stock.shortname | highlight: $select.search"></span>\n              </div> \n              \n          </ui-select-choices>\n          \n      </ui-select>\n      ',scope:{ddModel:"=",ddSubModel:"@",ddChange:"=",required:"@",placeholder:"@"},link:(e,t,n)=>{e.ddSubModel=e.ddSubModel||"stock",e.required="required"===e.required},controller:["$scope","StockService","YahooService",function(e,t,n){var o=this;function i(e){if(e)return n.findStocks(e).then((({quotes:e})=>{o.stocks=e})).catch((()=>{}))}function a(t){if(e.ddChange){let n=_.find(o.stocks,["code",t]);n&&e.ddChange.call(void 0,n)}}o.stocks=[],o.ddChange=a,o.findStocks=i}],controllerAs:"vm"}}angular.module("fm").directive("ddStock",e),e.$inject=[]}(),function(){"use strict";function e(){return{restrict:"A",scope:{containerId:"@",filename:"@"},link:function(e,t,n){t[0],t.bind("click",(function(t){var n,o=document.querySelectorAll(`#${e.containerId} table`),i="";for(let e of o){for(var a=0;a<e.rows.length;a++){for(var r=e.rows[a].cells,s=0;s<r.length;s++)i=i+((n=r[s]).hasAttribute("no-export")?"":n.innerText.replace(/\$/g,"").replace(/\,/g,""))+",";i=i.substring(0,i.length-1),i+="\n"}i+="\n\n"}i=i.substring(0,i.length-1);var c=document.createElement("a");c.style.display="none",c.href="data:application/octet-stream;base64,"+btoa(i),c.download=e.filename,document.getElementsByTagName("body")[0].appendChild(c),c.click(),c.remove()}))}}}angular.module("fm").directive("csvDownload",e),e.$inject=[]}(),function(){"use strict";function e(){return{restrict:"E",template:'\n      <ui-select ng-model=\'ddModel[ddSubModel]\' ng-change=\'vm.ddChange(ddModel[ddSubModel])\' reset-search-input=\'false\' name="uiSelectStockList" ng-required="required">\n          <ui-select-match placeholder="Stock list" allow-clear="true">\n              {{ $select.selected.name }}\n          </ui-select-match>\n          \n          <ui-select-choices repeat=\'list.id as list in vm.stockLists | filter: $select.search\'>\n              <div ng-bind-html="list.name | highlight: $select.search"></div>\n          </ui-select-choices>\n          \n      </ui-select>\n      ',scope:{ddModel:"=",ddSubModel:"@",type:"@",ddChange:"=",required:"@",ddOptions:"="},link:(e,t,n)=>{e.ddSubModel=e.ddSubModel||"stock_list",e.required="required"===e.required},controller:["$scope","$timeout","StockList",function(e,t,n){var o=this;function i(i){let a={page:o.page,page_size:150,ordering:"name",list_type:e.type};return i&&(a.name=i),n.getAll(a).then((({results:n})=>{if(o.stockLists=n,o.stockLists.length)if(o.init){const n=_.find(o.stockLists,(e=>e.id==o.init));n&&(e.ddModel[e.ddSubModel]=null,t((()=>{e.ddModel[e.ddSubModel]=n.id,s(e.ddModel[e.ddSubModel])}),200))}else e.ddModel[e.ddSubModel]=o.stockLists[0].id,s(e.ddModel[e.ddSubModel])})).catch((()=>{}))}function a(){o.init=null,i()}function r(e){o.init=e,i()}function s(t){if(e.ddChange){let n=_.find(o.stockLists,["id",t]);n&&e.ddChange.call(void 0,n)}}o.stocks=[],o.init=null,o.ddChange=s,e.ddOptions&&(e.ddOptions.refresh=a,e.ddOptions.refreshAndSelect=r),i()}],controllerAs:"vm"}}angular.module("fm").directive("ddStocklist",e),e.$inject=[]}(),function(){"use strict";function e(){return{restrict:"E",template:' \n<div class="modal d-block" ng-if="show">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title"> {{ vm.actionName}} {{ vm.typeName }}</h5>\n        <button type="button" class="close" ng-click="vm.onCancel()">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <form name="vm.newForm" ng-submit="vm.onSubmit()">\n        <div class="modal-body">\n          <div class="form-group">\n            <label for="forName">Name</label>\n            <input type="text" class="form-control" id="forName" placeholder="{{ vm.typeName }}" ng-model="vm.newList.name" auto-focus="true">\n            <small id="emailHelp" class="form-text text-muted">Your list name should simple and easy to remember.</small>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="btn btn-secondary" ng-click="vm.onCancel()">Cancel</button>\n          <button type="submit" class="btn btn-success" ng-if="action!=\'update\'">\n            <i class="material-icons">add</i>\n            Save\n          </button>\n          <button type="submit" class="btn btn-primary" ng-if="action==\'update\'">\n            Save\n          </button>  \n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n</div>\n<div class="modal-backdrop fade show" ng-if="show"></div>\n      ',scope:{onSuccess:"=",onError:"=",type:"@",action:"=",show:"=",data:"="},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope","$rootScope","StockList","ToastService",function(e,t,n,o){let i=this;function a(){i.newForm.$valid&&("update"==e.action.toLowerCase()?n.partialUpdate(i.newList.id,{name:i.newList.name}).then((({data:t})=>{o.success({title:"Update databank",body:"Update databank success."}),e.onSuccess&&e.onSuccess(t),e.show=!1,i.newList.name=""})).catch((t=>{o.danger({title:"Update databank",body:"Failed to update databank."}),e.onError&&e.onError(t)})):n.create(i.newList).then((({data:t})=>{o.success({title:"New databank",body:"Create new databank success."}),e.onSuccess&&e.onSuccess(t),e.show=!1,i.newList.name=""})).catch((t=>{o.danger({title:"New databank",body:"Failed to create new databank."}),e.onError&&e.onError(t)})))}function r(){e.show=!1}console.log("[stocklistModal] activate"),i.newList={},i.options={},i.onSubmit=a,i.onCancel=r,e.$watch("show",((t,n)=>{i.typeName=e.type,i.newList={},i.actionName="update"===e.action?"Update":"New",e.data&&"update"===e.action&&(i.newList=_.clone(e.data)),i.newList.list_type||(i.newList.list_type="watchlist"===e.type.toLowerCase()?0:1)}))}]}}angular.module("fm").directive("stocklistModal",e),e.$inject=[]}(),function(){"use strict";function e(){return{restrict:"E",template:' \n<div class="modal d-block" ng-if="vm.show">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title">Buy Stock</h5>\n        <button type="button" class="close" ng-click="vm.show=false">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <form class="form" name="vm.form" ng-submit="vm.onBuy()">\n        <div class="modal-body">  \n          <div class="form-group row">\n            <label class="col-sm-4 col-form-label">Portfolio</label>\n            <div class="col-sm-8">\n              <div class="form-control">{{ vm.currentPortfolio.name }}</div>\n            </div>\n          </div>\n          <div class="form-group row">\n            <label class="col-sm-4 col-form-label">Symbol</label>\n            <div class="col-sm-8">\n              <div class="form-control">{{ vm.stockInfo.symbol }}</div>\n            </div>\n          </div>\n          <div class="form-group row">\n            <label class="col-sm-4 col-form-label">Name</label>\n            <div class="col-sm-8">\n              <div class="form-control">{{ vm.stockInfo.shortname }}</div>\n            </div>\n          </div>\n          <div class="form-group row">\n            <label class="col-sm-4 col-form-label">Investment</label>\n            <div class="col-sm-8">\n              <div class="form-control">{{ vm.dividendInfo.investmentCash | currency:\'$\' }}</div>\n              <div>= <span class="text-success">{{ vm.buyInfo.init_share }}</span> (Share) * <span class="text-success">{{ vm.buyInfo.init_price | currency:\'$\'}}</span> (Per Share)</div>\n            </div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="btn btn-secondary" ng-click="vm.show=false">Close</button>\n          <button type="submit" class="btn btn-success" \n            ng-disabled="!vm.form.$valid">\n            <i class="material-icons">shopping_cart</i>\n            Buy\n          </button>\n        </div>\n      </form>\n    </div>\n  </div>\n</div>\n<div class="modal-backdrop fade show" ng-if="vm.show"></div>\n      ',scope:{},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope","$rootScope","StockService","ToastService",function(e,t,n,o){let i=this;function a(){if(!i.form.$valid)return;const e=_.clone(i.buyInfo);var a;e.portfolio=i.currentPortfolio.id,"cash"===e.initType&&(e.init_amount=_.round(i.dividendInfo.investmentCash,2)),(a=e,n.buyDividendStock(a).then((()=>{o.success({title:"Buy stock success",body:"The stock has been added to your porfolio"})})).catch((({data:e})=>{let t="There is an issue when adding stock to your portfolio";e&&e.non_field_errors&&(t="This stock is already exist in your porfolio"),o.danger({title:"Buy stock failed",body:t})}))).then((()=>{i.show=!1,t.$broadcast("BUY_STOCK_CONFIRM")}))}console.log("[confirmModal] activate"),i.show=!1,i.onBuy=a,e.$on("BUY_STOCK_SHOW",((e,t,n,o,a)=>{i.stockInfo=t,i.buyInfo=n,i.dividendInfo=o,i.currentPortfolio=a,i.show=!0}))}]}}angular.module("fm").directive("buyStock",e),e.$inject=[]}(),function(){"use strict";function e(){return{restrict:"E",template:' \n<div class="modal d-block" ng-if="vm.show">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title">Sell Stock</h5>\n        <button type="button" class="close" ng-click="vm.show=false">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <form class="form" name="vm.form" ng-submit="vm.onSell()">\n        <div class="modal-body">  \n          <div class="form-group row">\n            <label class="col-sm-4 col-form-label">Portfolio</label>\n            <div class="col-sm-8">\n              <div class="form-control">{{ vm.portfolio.name }}</div>\n            </div>\n          </div>\n          <div class="form-group row">\n            <label class="col-sm-4 col-form-label">Stock</label>\n            <div class="col-sm-8">\n              <div class="form-control">{{ vm.stockInfo.symbol }} - {{ vm.stockInfo.displayName }} </div>\n            </div>\n          </div>\n          <div class="form-group row">\n            <label class="col-sm-4 col-form-label">Sell Amount</label>\n            <div class="col-sm-6 pr-0">\n              <input class="form-control border-info" ng-model="vm.sellAmount" max="{{ vm.stockInfo.init_share }}" type="number">\n            </div>\n            <div class="col-sm-2 pl-1 pt-2">/{{ vm.stockInfo.init_share }}</div>\n          </div>\n          <div class="form-group row">\n            <label class="col-sm-4 col-form-label">At Price</label>\n            <div class="col-sm-8">\n              <input class="form-control border-info" ng-model="vm.sellPrice" type="number" step="any">\n              <div>= <span class="text-success">{{ vm.sellAmount }} * {{ vm.sellPrice | currency:\'$\' }} - $9.99 (fee)</span></div>\n              <div>= <span class="text-success">{{ (vm.sellAmount * vm.sellPrice - 9.99) | currency:\'$\' }}</span></div>\n            </div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="btn btn-secondary" ng-click="vm.show=false">Close</button>\n          <button type="submit" class="btn btn-danger" \n            ng-disabled="!vm.form.$valid">\n            <i class="material-icons">local_atm</i>\n            Sell\n          </button>\n        </div>\n      </form>\n    </div>\n  </div>\n</div>\n<div class="modal-backdrop fade show" ng-if="vm.show"></div>\n      ',scope:{},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope","$rootScope","StockService","ToastService",function(e,t,n,o){let i=this;function a(){var e,a;i.form.$valid&&(e=i.stockInfo.id,a={amount:i.sellAmount,price:i.sellPrice},n.sellDividendStock(e,a).then((()=>{o.success({title:"Sell Stock",body:"Your stock has been sold"})})).catch((({data:e})=>{o.danger({title:"Sell Stock",body:"There is an issue when processing. Please check and try again!"})}))).then((()=>{i.show=!1,t.$broadcast("SELL_STOCK_CONFIRM")}))}console.log("[confirmModal] activate"),i.show=!1,i.stockInfo=null,i.portfolio=null,i.sellAmount=0,i.sellPrice=0,i.onSell=a,e.$on("SELL_STOCK_SHOW",((e,t,n)=>{i.stockInfo=t,i.portfolio=n,i.show=!0,i.sellAmount=t.init_share,i.sellPrice=t.currentStockPrice}))}]}}angular.module("fm").directive("sellStock",e),e.$inject=[]}(),function(){"use strict";function e(){return{restrict:"E",template:'\n      <div class="input-group">\n        <div class="flex-grow-1">\n          <ui-select ng-model=\'ddModel[ddSubModel]\' ng-change=\'vm.ddChange(ddModel[ddSubModel])\' reset-search-input=\'false\' name="uiSelectPorfolio" style="min-width:180px;">\n            <ui-select-match placeholder="Select Porfolio" allow-clear="true">\n                {{ $select.selected.name }}\n            </ui-select-match>\n            <ui-select-choices repeat=\'porfolio.id as porfolio in vm.portfolios | filter: $select.search\'>\n                <div ng-bind-html=\'porfolio.name | highlight: $select.search\'></div> \n            </ui-select-choices>  \n          </ui-select>\n        </div>\n        <div class="input-group-append">\n          <button class="btn btn-success" type="button" ng-click="vm.newPortfolio={};vm.showAddModal=true">\n            <i class="material-icons">add</i>\n          </button>\n          <button class="btn btn-info" type="button" ng-if="vm.hasEdit && vm.selected" ng-click="vm.showUpdate(ddModel[ddSubModel])">\n            <i class="material-icons">edit</i>\n          </button>\n          <button class="btn btn-danger" type="button" ng-if="vm.hasDelete && vm.selected" ng-click="vm.onDelete(ddModel[ddSubModel])">\n            <i class="material-icons">delete</i>\n          </button>\n        </div>\n\n        \x3c!--modal --\x3e\n        <div class="modal d-block" ng-if="vm.showAddModal">\n          <div class="modal-dialog">\n            <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title">Add new Portfolio</h5>\n                <button type="button" class="close" ng-click="vm.showAddModal=false">\n                  <span aria-hidden="true">&times;</span>\n                </button>\n              </div>\n              <div class="modal-body">\n                <div class="mb-3 form-group row">\n                  <label class="col-sm-4 col-form-label">Portfolio Name<span class="text-danger">*</span></label>\n                  <div class="col-sm-8">\n                  <input type="text" class="form-control" ng-model="vm.newPortfolio.name" required auto-focus="true">\n                  </div>\n                </div>\n              </div>\n              <div class="modal-footer">\n                <button type="button" class="btn btn-secondary" ng-click="vm.showAddModal=false">Cancel</button>\n                <button type="button" class="btn btn-success" ng-disabled="!vm.newPortfolio.name || vm.isLoading" ng-click="vm.onAddNew(vm.newPortfolio)">\n                  <i class="material-icons">add</i>\n                  Add\n                </button>  \n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        \x3c!--edit modal --\x3e\n        <div class="modal d-block" ng-if="vm.showEditModal">\n          <div class="modal-dialog">\n            <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title">Update Portfolio</h5>\n                <button type="button" class="close" ng-click="vm.showEditModal=false">\n                  <span aria-hidden="true">&times;</span>\n                </button>\n              </div>\n              <div class="modal-body">\n                <div class="mb-3 form-group row">\n                  <label class="col-sm-4 col-form-label">Portfolio Name<span class="text-danger">*</span></label>\n                  <div class="col-sm-8">\n                  <input type="text" class="form-control" ng-model="vm.editPortfolio.name" required auto-focus="true">\n                  </div>\n                </div>\n              </div>\n              <div class="modal-footer">\n                <button type="button" class="btn btn-secondary" ng-click="vm.showEditModal=false">Cancel</button>\n                <button type="button" class="btn btn-primary" ng-disabled="!vm.editPortfolio.name || vm.isLoading" ng-click="vm.onUpdate(vm.editPortfolio)">\n                  <i class="material-icons">save</i>\n                  Update\n                </button>  \n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="modal-backdrop fade show" ng-if="vm.showAddModal||vm.showEditModal"></div>\n      ',scope:{ddModel:"=",ddSubModel:"@",ddChange:"=",ddInit:"@",hasEdit:"@",hasDelete:"@",option:"=?"},link:(e,t,n)=>{e.ddModel=e.ddModel||{},e.ddSubModel=e.ddSubModel||"id",e.option=e.option||{}},controller:["$scope","$timeout","Portfolio","ToastService","ConfirmService",function(e,t,n,o,i){var a=this;function r(t){let o={page:a.page,page_size:200,ordering:"name"};return t&&(o.name=t),n.getAll(o).then((({results:t})=>{a.portfolios=t;const n=a.selected||e.ddInit;if(n){const t=_.find(a.portfolios,(e=>e.id==n));t&&(e.ddModel[e.ddSubModel]=t.id,u(t.id))}else{const t=_.first(a.portfolios);t&&(e.ddModel[e.ddSubModel]=t.id,u(t.id))}})).catch((()=>{}))}function s(t){if(t.name&&!a.isLoading)return a.isLoading=!0,n.create(t).then((({data:t})=>{a.portfolios.unshift(t),e.ddModel[e.ddSubModel]=t.id,a.showAddModal=!1,o.success({title:"Add new portfolio success",body:"Your new portfolio has been added"})})).catch((()=>{o.danger({title:"Failed to add new Portfolio",body:"There is an error when adding new portfolio, please try again later"})})).finally((()=>{a.isLoading=!1}))}function c(t){if(!a.selected)return;let r=_.find(a.portfolios,["id",t]);r&&i.show({content:`Do you want to delete Portfolio ${r.name} ?`}).then((()=>n.remove(t))).then((()=>{o.success({title:"Delete Portfolio",body:"Your portfolio has been deleted successfully"}),_.remove(a.portfolios,["id",t]),a.portfolios.length&&(e.ddModel[e.ddSubModel]=a.portfolios[0].id)})).catch((()=>{o.danger({title:"Delete Portfolio",body:"Failed to delete portfolio at the moment. Please check and try again"})}))}function l(e){if(!e)return;let t=_.find(a.portfolios,["id",e]);t&&(this.editPortfolio={...t},this.showEditModal=!0)}function d(i){if(i.name&&!a.isLoading)return a.isLoading=!0,n.update(i.id,i).then((({data:n})=>{const i=_.findIndex(a.portfolios,["id",n.id]);i<0?a.portfolios.unshift(n):a.portfolios[i]=n,e.ddModel[e.ddSubModel]=null,t((()=>{e.ddModel[e.ddSubModel]=n.id}),20),a.showEditModal=!1,o.success({title:"Update portfolio",body:"Your portfolio has been updated"})})).catch((()=>{o.danger({title:"Update portfolio",body:"There is an error when updating your portfolio, please try again later"})})).finally((()=>{a.isLoading=!1}))}function u(t){let n=_.find(a.portfolios,["id",t]);n&&(a.selected=n.id,e.ddChange&&e.ddChange.call(void 0,n))}function m(){r()}a.portfolios=[],a.selected=null,a.newPortfolio={},a.editPortfolio={},a.isLoading=!1,a.showEditModal=!1,a.hasEdit="false"!==e.hasEdit,a.hasDelete="false"!==e.hasDelete,e.option=e.option||{},e.option.refresh=m,a.onAddNew=s,a.onDelete=c,a.onUpdate=d,a.showUpdate=l,a.ddChange=u,r()}],controllerAs:"vm"}}angular.module("fm").directive("ddPortfolio",e),e.$inject=[]}(),function(){"use strict";function e(e,t,n){return{restrict:"E",templateUrl:"views/budget/annualIncome.html",scope:{items:"=",budgetId:"@",callback:"="},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope",function(e){let o=this;function i(i){n.show().then((()=>{_.remove(o.items,["id",i.id]),r(),e.callback&&e.callback.deleteItem&&e.callback.deleteItem.call(null,i,o.items),"number"==typeof i.id&&t.deleteAnnualIncome(i.id).then((()=>{console.log("[annualIncome.directive] deleteCategory then")}))}))}function a(){o.items.push({id:`i_${Math.random()}`,name:"",budget:o.budgetId,editing:!0}),o.rowEditing=!0}function r(){o.total_yearly=_.sumBy(o.items,"yearly")}function s(e){if(!e.name||""==e.name||void 0===e.yearly)return;let n=null;e.yearly=_.round(e.yearly,2),n="string"==typeof e.id&&e.id.indexOf("i_")>=0?t.createAnnualIncome({id:void 0,budget:o.budgetId,...e}):t.updateAnnualIncome(e.id,e),e.editing=!1,o.rowEditing=!1,n.then((({data:t})=>{console.log("[annualIncome.directive] saveItem then"),e.id=t.id,r()}))}function c(e){e.zero=!e.zero,e.zero?(e.yearly_bak=e.yearly,e.yearly=0):e.yearly=e.yearly_bak}function l(e){const n=_.findIndex(o.items,(t=>t.id==e.id));if(n<0)return;if(n>=o.items.length-1)return;const i=o.items[n];o.items[n]=o.items[n+1],o.items[n+1]=i,t.annualIncomeDown(e.id).then((()=>{console.log("Item moved down")}))}function d(e){const n=_.findIndex(o.items,(t=>t.id==e.id));if(n<=0)return;if(n>o.items.length-1)return;const i=o.items[n];o.items[n]=o.items[n-1],o.items[n-1]=i,t.annualIncomeUp(e.id).then((()=>{console.log("Item moved up")}))}console.log("[annualIncome] activate"),o.currentYear=(new Date).getFullYear(),o.rowEditing=!1,o.items=e.items,o.budgetId=parseInt(e.budgetId),o.deleteItem=i,o.addItem=a,o.calculateTotal=r,o.saveItem=s,o.setZero=c,o.itemMoveUp=d,o.itemMoveDown=l,e.callback&&e.callback.ready&&e.callback.ready.call(null),r()}]}}angular.module("fm").directive("annualIncome",e),e.$inject=["$timeout","ApiService","ConfirmService"]}(),function(){"use strict";function e(e,t,n){return{restrict:"E",templateUrl:"views/budget/netasset.html",scope:{items:"=",budgetId:"@",callback:"="},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope",function(e){let o=this;function i(i){n.show().then((()=>{_.remove(o.items,["id",i.id]),r(),e.callback&&e.callback.deleteItem&&e.callback.deleteItem.call(null,i,o.items),"number"==typeof i.id&&t.deleteNetAsset(i.id).then((()=>{console.log("[NetAsset.directive] deleteCategory then")}))}))}function a(){o.items.push({id:`i_${Math.random()}`,name:"",budget:o.budgetId,editing:!0}),o.rowEditing=!0}function r(){o.total_yearly=_.sumBy(o.items,"yearly"),e.callback&&e.callback.onTotalChange&&e.callback.onTotalChange.call(null,o.total_yearly)}function s(e){if(!e.name||""==e.name||void 0===e.yearly)return;let n=null;e.yearly=_.round(e.yearly,2),n="string"==typeof e.id&&e.id.indexOf("i_")>=0?t.createNetAsset({id:void 0,budget:o.budgetId,...e}):t.updateNetAsset(e.id,e),e.editing=!1,o.rowEditing=!1,n.then((({data:t})=>{console.log("[NetAsset.directive] saveItem then"),e.id=t.id,r()}))}function c(e){e.zero=!e.zero,e.zero?(e.yearly_bak=e.yearly,e.yearly=0):e.yearly=e.yearly_bak}function l(e){const n=_.findIndex(o.items,(t=>t.id==e.id));if(n<0)return;if(n>=o.items.length-1)return;const i=o.items[n];o.items[n]=o.items[n+1],o.items[n+1]=i,t.netAssetDown(e.id).then((()=>{console.log("Item moved down")}))}function d(e){const n=_.findIndex(o.items,(t=>t.id==e.id));if(n<=0)return;if(n>o.items.length-1)return;const i=o.items[n];o.items[n]=o.items[n-1],o.items[n-1]=i,t.netAssetUp(e.id).then((()=>{console.log("Item moved up")}))}console.log("[NetAsset.directive] activate"),o.currentYear=(new Date).getFullYear(),o.rowEditing=!1,o.items=e.items,o.budgetId=parseInt(e.budgetId),o.deleteItem=i,o.addItem=a,o.calculateTotal=r,o.saveItem=s,o.setZero=c,o.itemMoveUp=d,o.itemMoveDown=l,e.callback&&e.callback.ready&&e.callback.ready.call(null),r()}]}}angular.module("fm").directive("netAsset",e),e.$inject=["$timeout","ApiService","ConfirmService"]}(),function(){"use strict";function e(e,t,n){return{restrict:"E",templateUrl:"views/budget/liability.html",scope:{items:"=",budgetId:"@",callback:"="},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope",function(e){let o=this;function i(i){n.show().then((()=>{_.remove(o.items,["id",i.id]),r(),e.callback&&e.callback.deleteItem&&e.callback.deleteItem.call(null,i,o.items),"number"==typeof i.id&&t.deleteLiability(i.id).then((()=>{console.log("[Liability.directive] deleteCategory then")}))}))}function a(){o.items.push({id:`i_${Math.random()}`,name:"",budget:o.budgetId,editing:!0}),o.rowEditing=!0}function r(){o.total_yearly=_.sumBy(o.items,"yearly"),o.total_monthly=_.sumBy(o.items,"monthly"),e.callback&&e.callback.onTotalChange&&e.callback.onTotalChange.call(null,o.total_yearly)}function s(e){if(!e.name||""==e.name||void 0===e.yearly)return;let n=null;e.yearly=_.round(e.yearly,2),n="string"==typeof e.id&&e.id.indexOf("i_")>=0?t.createLiability({id:void 0,budget:o.budgetId,...e}):t.updateLiability(e.id,e),e.editing=!1,o.rowEditing=!1,n.then((({data:t})=>{console.log("[Liability.directive] saveItem then"),e.id=t.id,r()}))}function c(e){e.zero=!e.zero,e.zero?(e.yearly_bak=e.yearly,e.yearly=0):e.yearly=e.yearly_bak}function l(e){const n=_.findIndex(o.items,(t=>t.id==e.id));if(n<0)return;if(n>=o.items.length-1)return;const i=o.items[n];o.items[n]=o.items[n+1],o.items[n+1]=i,t.liabilityDown(e.id).then((()=>{console.log("Item moved down")}))}function d(e){const n=_.findIndex(o.items,(t=>t.id==e.id));if(n<=0)return;if(n>o.items.length-1)return;const i=o.items[n];o.items[n]=o.items[n-1],o.items[n-1]=i,t.liabilityUp(e.id).then((()=>{console.log("Item moved up")}))}function u(e){return"number"==typeof e.id}console.log("[liability.directive] activate"),o.currentYear=(new Date).getFullYear(),o.total_monthly=0,o.total_yearly=0,o.rowEditing=!1,o.items=e.items,o.budgetId=parseInt(e.budgetId),o.deleteItem=i,o.addItem=a,o.calculateTotal=r,o.saveItem=s,o.setZero=c,o.itemMoveUp=d,o.itemMoveDown=l,o.canMove=u,e.callback&&e.callback.ready&&e.callback.ready.call(null),r()}]}}angular.module("fm").directive("liability",e),e.$inject=["$timeout","ApiService","ConfirmService"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s){let c=this;function l(){console.log("[main.controller.js] doLogout"),a.logout(),c.isLoggedIn=!1,n((()=>{o.path("/login")}),100)}function d(){_.each(c.dropdownMenu,((e,t)=>{c.dropdownMenu[t]=!1}))}function u(e){o.path(e),c.openMenu=!1,d()}function m(){d(),s.send("BODY_CLICKED")}function f(e,t){d(),c.dropdownMenu[e]=!0,t.stopPropagation()}c.user={name:""},c.currentTime=null,c.timezone=function(){let e=Intl.DateTimeFormat().resolvedOptions().timeZone;return moment().tz(e).format("z")}(),c.openMenu=!1,c.isLoggedIn=t.me,c.currentPath=o.path(),c.dropdownMenu={},c.doLogout=l,c.navigate=u,c.bodyClick=m,c.showDropdown=f,e.$on("LOGGEDIN",((e,t)=>{c.user=t,c.isLoggedIn=!0})),t.$on("$routeChangeSuccess",((e,t,n,i,a)=>{c.currentPath=o.path()})),c.currentTime=new Date,i((()=>{c.currentTime=new Date}),3e4),console.log(o.path())}angular.module("fm").controller("MainController",e),e.$inject=["$scope","$rootScope","$timeout","$location","$interval","ApiService","PermissionService","Broadcast"]}(),function(){"use strict";function e(e,t,n,o,i,a){let r=this;function s(e){console.log("onDeleteBudget:",e.id);let t=_.findIndex(r.budgets,["id",e.id]);t>=0&&o((()=>{r.budgets.splice(t,1)}))}function c(t,n){let i=_.findIndex(r.budgets,(e=>e.id==n));o((()=>{console.log(r.budgets),i<0?r.budgets.push(t):r.budgets.splice(i+1,0,t),e.$apply(),console.log(r.budgets)}))}a.is_permit("budget")&&(console.log("[BudgetController] activate"),r.budgets=[],r.budgetCallback={},r.budgetCallback.deleteBudget=s,r.budgetCallback.addBudget=c,i.getBudgets().then((({results:e})=>{r.budgets=e})).catch((e=>{401===e.status&&n.path("/login")})))}angular.module("fm").controller("BudgetController",e),e.$inject=["$scope","$rootScope","$location","$timeout","ApiService","PermissionService"]}(),function(){"use strict";function e(e,t,n,o,i,a){let r=this;function s(){i.copyDebt().then((({data:e})=>{console.log("[debt.controller.js] addDebt then"),e.length?_.each(e,(e=>{r.debts.push(e)})):r.debts.push(e)}))}function c(e){_.remove(r.debts,["id",e.id])}a.is_permit("debt")&&(console.log("[debt.controller.js] activate"),r.debts=[],r.callback={},r.callback.deleteDebt=c,r.addDebt=s,i.getDebts().then((({results:e})=>{r.debts=e})))}angular.module("fm").controller("DebtController",e),e.$inject=["$scope","$rootScope","$timeout","ApiService","DebtApi","PermissionService"]}(),function(){"use strict";function e(e,t,n,o,i){let a=this;function r(e,t){a.loginError=!1,i.login(e,t).then((()=>i.getProfile())).then((()=>{o.path("/routing")})).catch((()=>{a.loginError=!0}))}a.loginError=!1,a.login=r}angular.module("fm").controller("LoginController",e),e.$inject=["$scope","$rootScope","$timeout","$location","ApiService"]}(),function(){"use strict";function e(e,t,n,o,i){let a=this;function r(e){a.registerError=!1,a.isWaiting=!0,i.register(e).then((function(e){a.registerSuccess=!0,n((()=>{o.path("/login")}),5e3)})).catch((({data:e})=>{a.registerError=!0,e.detail?a.errorText=e.detail:_.each(e,(e=>(a.errorText=e[0],!1)))})).finally((()=>{a.isWaiting=!1}))}a.registerError=!1,a.registerSuccess=!1,a.errorText="",a.isWaiting=!1,a.register=r,a.GENDERS=[{label:"Male",value:1},{label:"Female",value:2},{label:"Other",value:3}]}angular.module("fm").controller("RegisterController",e),e.$inject=["$scope","$rootScope","$timeout","$location","ApiService"]}(),function(){"use strict";function e(e,t,n,o,i){let a=this;function r(e){a.forgotSuccess=!1,a.isWaiting=!0,a.errorText="",i.forgot(e).then((function(e){a.forgotSuccess=!0})).catch((({data:e})=>{e.detail?a.errorText=e.detail:_.each(e,(e=>(a.errorText=e[0],!1)))})).finally((()=>{a.isWaiting=!1}))}a.forgotSuccess=!1,a.forgot=r,a.isWaiting=!1,a.errorText=""}angular.module("fm").controller("ForgotController",e),e.$inject=["$scope","$rootScope","$timeout","$location","ApiService"]}(),function(){"use strict";function e(e,t,n,o,i){let a=this;!function e(){var r;a.activateStatus=0,a.activate=e,r={uid:t.uid,token:t.token},a.forgotSuccess=!1,i.activate(r).then((function(e){a.activateStatus=1,n((()=>{o.path("/login")}),5e3)})).catch((()=>{a.activateStatus=2}))}()}angular.module("fm").controller("ActivateController",e),e.$inject=["$scope","$routeParams","$timeout","$location","ApiService"]}(),function(){"use strict";function e(e,t,n,o,i){let a=this;function r(e){a.resetForm.$valid&&a.user.new_password==a.user.retype_password&&(a.errorText="",a.resetStatus=0,i.reset(e).then((function(e){a.resetStatus=1,n((()=>{o.path("/login")}),5e3)})).catch((({data:e})=>{e.detail?a.errorText=e.detail:_.each(e,(e=>(a.errorText=e[0],!1)))})))}a.resetStatus=0,a.errorText="",a.reset=r,a.user={uid:t.uid,token:t.token}}angular.module("fm").controller("ResetController",e),e.$inject=["$scope","$routeParams","$timeout","$location","ApiService"]}(),function(){"use strict";function e(e,t,n,o,i,a,r){let s=this;function c(e){let t=[];return _.each(e,(e=>{t.push(a.getQuoteSummary(e))})),Promise.all(t).then((()=>{console.log("getYahooQuoteSummary then")}))}function l(e){let t=[];return _.each(e,(e=>{t.push(a.getChart(e))})),Promise.all(t).then((()=>{console.log("getYahooChart then")}))}function d(e){let t=[];return _.each(e,(e=>{t.push(a.getHistory(e))})),Promise.all(t).then((()=>{console.log("getYahooChart then")}))}function u(){s.stocks.push({code:"",editing:!0})}function m(e){let t=null;return e.code=e.code.toUpperCase(),t=e.id?i.updateStock(e.id,e):i.addStock(e),t.then((({data:t})=>{e.editing=!1,e.id||(e.id=t.id),function(e){console.log("Clear stock"),_.each(s.fields,(t=>{e[t.field]&&(e[t.field]="N/A")}))}(e),function(e){a.getQuote([e.code]).then((()=>c([e.code]))).then((()=>l([e.code]))).then((()=>d([e.code]))).then((()=>{let t=a.parseStock(e.code);n((()=>{e=_.extend(e,t)}),100)})).catch((e=>{console.log("Yahoo API Error"),console.log(e)}))}(e)}))}function f(e){i.deleteStock(e.id).then((()=>{e.editing=!1,_.remove(s.stocks,["id",e.id])})).catch((e=>{}))}function h(e){_.remove(s.stocks,["id",e.id])}function g(e){i.updateStockNote({note:e}).then((e=>{console.log(e)})).catch((e=>{console.log(e)}))}r.is_permit("stock")&&(console.log("[StockController] activate"),s.fields=i.STOCK_FIELDS,s.stockCallback={},s.stockNote="",s.stockCallback.deleteStock=h,s.addStock=u,s.saveStock=m,s.deleteStock=f,s.updateNote=g,i.getStocks().then((({results:e})=>{s.stocks=e})).then((()=>{let e=_.map(s.stocks,"code");return a.getQuote(e)})).then((()=>c(_.map(s.stocks,"code")))).then((()=>l(_.map(s.stocks,"code")))).then((()=>d(_.map(s.stocks,"code")))).then((()=>{console.log("getStocks then"),_.each(s.stocks,((e,t)=>{let n=a.parseStock(e.code);e=_.extend(e,n)}))})),i.getStockNote().then((({data:e})=>{console.log(e),s.stockNote=e.note})))}angular.module("fm").controller("StockController",e),e.$inject=["$scope","$rootScope","$timeout","ApiService","StockService","YahooService","PermissionService"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s){let c=this,l=7,d=1,u=4.4,m=1;function f(e){_.each(c.fields,(t=>{if("bondYield"==t.field){let n=o("date")(e.date,"yyyy-MM-dd");t.name=`${t.name} (${n})`}}))}function h(e){let t=[];return _.each(e,(e=>{t.push(r.getQuoteSummary(e))})),Promise.all(t).then((()=>{console.log("getYahooQuoteSummary then")}))}function g(e){let t=[];return _.each(e,(e=>{t.push(r.getChart(e))})),Promise.all(t).then((()=>{console.log("getYahooChart then")}))}function p(e){let t=[];return _.each(e,(e=>{t.push(r.getHistory(e))})),Promise.all(t).then((()=>{console.log("getYahooChart then")}))}function y(e){return e.fixedPE=l,e.fixed1G=d,e.fixedCorpBond=u,e}function v(){let e={code:"",editing:!0};e=y(e),c.stocks.push(e)}function b(e){let t=null;return e.code=e.code.toUpperCase(),t=e.id?a.updateIntrinsicStock(e.id,e):a.addIntrinsicStock(e),t.then((({data:t})=>{e.editing=!1,e.id||(e.id=t.id),function(e){console.log("Clear stock"),_.each(c.fields,(t=>{e[t.field]&&(e[t.field]="N/A")})),e=y(e)}(e),function(e){r.getQuote([e.code]).then((()=>h([e.code]))).then((()=>g([e.code]))).then((()=>p([e.code]))).then((()=>1!=m||a.getBondYield().then((({results:e})=>{e&&e.length&&(m=e[0].value,f(e[0]))})))).then((()=>{let t=r.parseStock(e.code);n((()=>{w(e=_.extend(e,t))}),100)})).catch((e=>{console.log("Yahoo API Error"),console.log(e)}))}(e)}))}function k(e){a.deleteIntrinsicStock(e.id).then((()=>{e.editing=!1,_.remove(c.stocks,["id",e.id])})).catch((e=>{}))}function S(e){_.remove(c.stocks,["id",e.id])}function w(e){if(e)return e.bondYield=m,e.intrinsic=e.trailingEPS*(e.fixedPE+e.fixed1G*e.netIncomeForecast)*e.fixedCorpBond/e.bondYield,e.buy_or_sale=e.intrinsic>e.currentStockPrice?"BUY":"SALE",void(e.upside=100*(e.intrinsic/e.currentStockPrice-1));_.each(c.stocks,(e=>{e.bondYield=m,e.intrinsic=e.trailingEPS*(e.fixedPE+e.fixed1G*e.netIncomeForecast)*e.fixedCorpBond/e.bondYield,e.buy_or_sale=e.intrinsic>e.currentStockPrice?"BUY":"SALE",e.upside=100*(e.intrinsic/e.currentStockPrice-1)}))}s.is_permit("intrinsicstock")&&(console.log("[IntrinsicController] activate"),c.fields=a.INTRINSIC_FIELDS,c.stockCallback={},c.stockCallback.deleteStock=S,c.addStock=v,c.saveStock=b,c.deleteStock=k,a.getIntrinsicStocks().then((({results:e})=>{var t;c.stocks=(t=e,_.each(t,(e=>{e=y(e)})),t)})).then((()=>{let e=_.map(c.stocks,"code");return r.getQuote(e)})).then((()=>h(_.map(c.stocks,"code")))).then((()=>g(_.map(c.stocks,"code")))).then((()=>p(_.map(c.stocks,"code")))).then((()=>a.getBondYield().then((({results:e})=>{e&&e.length&&(m=e[0].value,f(e[0]))})))).then((()=>{console.log("getStocks then"),_.each(c.stocks,((e,t)=>{let n=r.parseStock(e.code);e=_.extend(e,n)})),n((()=>{w()}),100)})).catch((e=>{console.log("[intrinsic.controller] ",e)})))}angular.module("fm").controller("IntrinsicController",e),e.$inject=["$scope","$rootScope","$timeout","$filter","ApiService","StockService","YahooService","PermissionService"]}(),function(){"use strict";function e(e,t,n,o,i){console.log("[root.controller.js] activate"),n((()=>{let e=i.firstAuthPage();o.path(e)}),100)}angular.module("fm").controller("RootController",e),e.$inject=["$scope","$rootScope","$timeout","$location","PermissionService"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s){let c=this;function l(e){let t=[];return _.each(e,(e=>{t.push(r.getQuoteSummary(e))})),Promise.all(t).then((()=>{console.log("getYahooQuoteSummary then")}))}function d(e){let t=[];return _.each(e,(e=>{t.push(r.getChart(e))})),Promise.all(t).then((()=>{console.log("getYahooChart then")}))}function u(e){let t=[];return _.each(e,(e=>{t.push(r.getHistory(e))})),Promise.all(t).then((()=>{console.log("getYahooChart then")}))}function m(e){switch(e.forwardDividend=0,e.dividendFrequency.toLowerCase()){case"monthly":e.dividendsPerShare=e.dividendsPerShare/12;break;case"quarterly":e.dividendsPerShare=e.dividendsPerShare/4;break;case"annually":break;case"semi-annually":e.dividendsPerShare=e.dividendsPerShare/2}return e}function f(){c.stocks.push({code:"",editing:!0,commission:9.99,exchange:"N/A"})}function h(e){let t=null;return e.code=e.code.toUpperCase(),t=e.id?a.updateDividendStock(e.id,e):a.addDividendStock(e),t.then((({data:t})=>{e.editing=!1,e.id||(e.id=t.id),function(e){console.log("Clear stock"),_.each(c.fields,(t=>{e[t.field]&&(e[t.field]="N/A")}))}(e),function(e){r.getQuote([e.code]).then((()=>l([e.code]))).then((()=>d([e.code]))).then((()=>u([e.code]))).then((()=>{let t=r.parseStock(e.code);n((()=>{e=m(e=_.extend(e,t)),y()}),100)})).catch((e=>{console.log("Yahoo API Error"),console.log(e)}))}(e)}))}function g(e){a.deleteDividendStock(e.id).then((()=>{e.editing=!1,_.remove(c.stocks,["id",e.id])})).catch((e=>{}))}function p(e){_.remove(c.stocks,["id",e.id])}function y(e){!function(){let e=_.sumBy(c.stocks,(e=>e.init_amount)),t=_.sumBy(c.stocks,(e=>e.init_amount*e.forwardDividend));c.averageYield=_.round(t/e,2)}()}s.is_permit("dividendstock")&&(console.log("[DividendCalculatorController] activate"),c.fields=a.DIVIDEND_FIELDS,c.stockCallback={},c.stocks=[],c.averageYield=0,c.stockCallback.deleteStock=p,c.addStock=f,c.saveStock=h,c.deleteStock=g,a.getDividendStocks().then((({results:e})=>{c.stocks=e})).then((()=>{let e=_.map(c.stocks,"code");return r.getQuote(e)})).then((()=>l(_.map(c.stocks,"code")))).then((()=>d(_.map(c.stocks,"code")))).then((()=>u(_.map(c.stocks,"code")))).then((()=>{console.log("getStocks then"),_.each(c.stocks,((e,t)=>{let n=r.parseStock(e.code);n=m(n),e=_.extend(e,n)})),n((()=>{y()}),100)})).catch((e=>{console.log("[intrinsic.controller] ",e)})))}angular.module("fm").controller("DividendCalculatorController",e),e.$inject=["$scope","$rootScope","$timeout","$filter","ApiService","StockService","YahooService","PermissionService"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,c,l){let d=this;function u(e){e&&(d.portfolio=e,function(e){return o.getDividendStocks({portfolio:e}).then((({results:e})=>{d.stocks=e}))}(e.id).then((()=>{let e=_.map(d.stocks,"code");return i.getQuote(e)})).then((()=>function(e){let t=[];return _.each(e,(e=>{t.push(i.getQuoteSummary(e))})),Promise.all(t).then((()=>{console.log("getYahooQuoteSummary then")}))}(_.map(d.stocks,"code")))).then((()=>function(e){let t=[];return _.each(e,(e=>{t.push(i.getChart(e))})),Promise.all(t).then((()=>{console.log("getYahooChart then")}))}(_.map(d.stocks,"code")))).then((()=>function(e){let t=[];return _.each(e,(e=>{t.push(i.getHistory(e))})),Promise.all(t).then((()=>{console.log("getYahooChart then")}))}(_.map(d.stocks,"code")))).then((()=>{console.log("getStocks then"),_.each(d.stocks,((e,t)=>{let n=i.parseStock(e.code);var o;(e=_.extend(e,n)).numberOfShare=e.init_share,"auto"!==e.dividend_frequency&&(e.dividendFrequency=e.dividend_frequency.charAt(0).toUpperCase()+e.dividend_frequency.slice(1)),e=function(e){let t=e.init_amount-e.commission;switch(e.numberOfShare=Math.floor(t/e.currentStockPrice),e.forwardDividend=0,(e=r.transformDividendsPerShare(e)).year=40,e.dividendFrequency.toLowerCase()){case"monthly":e.tick=12;break;case"quarterly":e.tick=4;break;case"annually":e.tick=1;break;case"semi-annually":e.tick=2}if(e.tickMargin=0,e.dividendDate&&"N/A"!==e.dividendDate){const t=moment(e.dividendDate).month();e.tickMargin=t%(12/e.tick)}return e}(e),(o=e).profit_or_lost=o.currentStockPrice-o.init_price,o.profit_or_lost_percent=_.round(100*(o.currentStockPrice-o.init_price)/o.init_price,2),e=o;let a=r.estimateDividend(e,e);return d.stockDividends[e.code]=a,n})),n((()=>{!function(){let e=0;d.monthlyReceived={},d.yearlyReceived=[0,0],e=_.sumBy(d.stocks,(e=>e.init_amount)),_.each(d.stocks,(t=>{t.percentageProfilio=_.round(t.init_amount/e*100,2)})),d.averageYield=_.round(_.sumBy(d.stocks,(e=>e.dividendYield))/d.stocks.length,2)}(),m(d.currentYear),d.portfolioInvestment=_.sumBy(d.stocks,(function(e){return e.init_share*e.currentStockPrice})),console.log(d.stockDividends)}),100)})).catch((e=>{console.log("[intrinsic.controller] ",e)})))}function m(e){d.monthlyReceived={},d.yearlyReceived=[0,0],_.each(d.stocks,(t=>{for(let n=0;n<12;n++)if(n%(12/t.tick)-t.tickMargin==0){d.monthlyReceived[n]||(d.monthlyReceived[n]=[0,0]);const o=(12*(e-1)+n-t.tickMargin)/(12/t.tick);if(d.stockDividends[t.code][o]){const e=d.stockDividends[t.code][o].dividendCash,i=d.stockDividends[t.code][o].dividendCashDrip;d.monthlyReceived[n][0]+=e,d.monthlyReceived[n][1]+=i,d.yearlyReceived[0]+=e,d.yearlyReceived[1]+=i}}}))}function f(e){console.log(e),m(e)}function h(e){l.show(e,d.portfolio).then((()=>{console.log("sell then"),d.portfolioOption&&d.portfolioOption.refresh&&d.portfolioOption.refresh()})).catch((()=>{console.log("sell cache")}))}a.is_permit("dividendstock")&&(console.log("[DividendSummaryController] activate"),d.fields=o.DIVIDEND_SUMMARY_FIELDS,d.stockCallback={},d.stocks=[],d.stockDividends={},d.averageYield=0,d.currentYear=1,d.currentPortfolio=null,d.portfolioInvestment=0,d.portfolio=null,d.portfolioOption={},d.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d.eachYears=r.generateYears(),d.fiveYears=r.generateYears(40,5),d.onChangeYear=f,d.sellStock=h,d.onChangePortfolio=u)}angular.module("fm").controller("DividendSummaryController",e),e.$inject=["$scope","$rootScope","$timeout","StockService","YahooService","PermissionService","DividendService","ConfirmService","ToastService","SellStockService"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,c,l,d,u,m,f,h,g,p,y){let v=this;function b(e){v.currentPortfolio=e}function k(){if(!v.newStockForm.$valid||v.loading)return;let e=v.newStock.stock.symbol;v.newStock.code=e,"share"===v.newStock.initType&&(v.newStock.init_amount=_.round(v.newStock.init_share*v.newStock.init_price+v.newStock.commission,2)),v.loading=!0,v.calculatedData=_.extend({},v.newStock),v.calculatedData.balance=v.currentPortfolio.balance,v.stockData={};let t={};Promise.all([r.stockInfo(e).then((({data:e})=>{t.summary=e})),r.stockChart(e).then((({data:e})=>{t.chart=e})),r.stockProfile(e).then((({data:e})=>{t.profile=e})),r.stockFinances(e).then((({data:e})=>{t.finances=e}))]).then((()=>(_.each(["balanceSheetHistory","balanceSheetHistoryQuarterly","cashflowStatementHistory","cashflowStatementHistoryQuarterly","incomeStatementHistory","incomeStatementHistoryQuarterly"],(e=>{t.summary[e]=t.finances[e]})),t.summary.assetProfile=t.profile.assetProfile,t=s.parse(t),"auto"!=v.calculatedData.dividend_frequency&&(t.dividendFrequency=v.calculatedData.dividend_frequency),"share"===v.calculatedData.initType&&(t.currentStockPrice=v.calculatedData.init_price),t=function(e,t){let n=t.init_amount-t.commission;switch(e.numberOfShare=Math.floor(n/e.currentStockPrice),e.forwardDividend=0,(e=d.transformDividendsPerShare(e)).code=t.code,e.dividendFrequency.toLowerCase()){case"monthly":e.tick=12;break;case"quarterly":e.tick=4;break;case"annually":e.tick=1;break;case"semi-annually":e.tick=2}return e}(t,v.calculatedData),t))).then((e=>{n((()=>{v.stockData=e,v.initDividend=d.getInitDividend(e,v.calculatedData),v.dividends=d.estimateDividend(e,v.calculatedData)}))})).catch((e=>{console.log(e),l.danger({title:"Failed to calculate",body:"We can not get stock information now, please try again later"})})).finally((()=>{v.loading=!1}))}function S(e){if(e!==v.stockData.code)return{};let t={name:v.stockData.displayName,sector:v.stockData.sector,exchange:v.stockData.exchange,last_price:v.stockData.lastPrice,price:v.stockData.currentStockPrice,price_change:v.stockData.priceChange,percent_change:v.stockData.priceChangePercentage,daily_high:v.stockData.dailyHigh,daily_low:v.stockData.dailyLow,volume:v.stockData.dailyVolume,dividend_frequency:0,dividend_rate:v.stockData.dividendsPerShare,dividend_yield:v.stockData.dividendYield,ex_dividend_date:_.isDate(v.stockData.exDividendDate)?moment(v.stockData.exDividendDate).format("YYYY-MM-DD"):void 0,payment_date:_.isDate(v.stockData.dividendDate)?moment(v.stockData.dividendDate).format("YYYY-MM-DD"):void 0};switch(v.stockData.dividendFrequency.toLowerCase()){case"monthly":t.dividend_frequency=1;break;case"quarterly":t.dividend_frequency=2;break;case"semi-annually":t.dividend_frequency=3;break;case"annually":t.dividend_frequency=4}return t}function w(){if(!v.newStockForm.$valid)return;let e=_.clone(v.newStock);e=_.extend(e,S(e.code)),f.create(e).then((()=>{l.success({title:"Add stock to databank",body:"The stock and been add to your databank"})})).catch((({data:e})=>{let t="There is an issue when adding stock to your databank";e&&e.non_field_errors&&(t="This stock is already exist in your databank"),l.danger({title:"Add stock failed",body:t})}))}function C(){if(!v.newStockForm.$valid)return;let e=_.clone(v.newStock);e=_.extend(e,S(e.code)),h.create(e).then((()=>{l.success({title:"Add stock success",body:"The stock and been add to your screener"})})).catch((({data:e})=>{let t="There is an issue when adding stock to your screener";e&&e.non_field_errors&&(t="This stock is already exist in your screener"),l.danger({title:"Add stock failed",body:t})}))}function A(){if(!v.newStockForm.$valid)return;let e=_.clone(v.newStock);e=_.extend(e,S(e.code)),g.create(e).then((()=>{l.success({title:"Add stock success",body:"The stock and been add to your watchlist"})})).catch((({data:e})=>{let t="There is an issue when adding stock to your watchlist";e&&e.non_field_errors&&(t="This stock is already exist in your watchlist"),l.danger({title:"Add stock failed",body:t})}))}function $(){let e=["css/app.css","libs/bootstrap.min.css","css/printjs.css"];ENV&&"production"==ENV&&(e=["/app.min.css","css/bootstrap.min.css","css/printjs.css"]),printJS({printable:"dividendCalculatorResult",type:"html",css:e,maxWidth:"1024px",targetStyles:["*"]})}function D(){v.newStockForm.$valid&&(v.newStock.stock&&(v.newStock.code=v.newStock.stock.symbol),"cash"===v.newStock.initType&&(v.newStock.init_price=v.initDividend.currentStockPrice,v.newStock.init_share=v.initDividend.numberOfShare),p.show(v.newStock.stock,v.newStock,v.initDividend,v.currentPortfolio).then((()=>{console.log("buy then")})).catch((()=>{console.log("buy cache")})))}function P(e,t){y.addBalance(v.currentPortfolio.id,{amount:e}).then((e=>{l.success({title:"Add Fund",body:"Your portfolio has been updated new balance"}),v.showAddFundModal=!1,v.portfolioOption&&v.portfolioOption.refresh&&v.portfolioOption.refresh()})).catch((e=>{console.log(e),l.danger({title:"Add Fund",body:"Your amount is not valid or you don't have permission on this portfolio"})}))}c.is_permit("dividendstock")&&(console.log("[DividendCalculatorAddController] activate"),v.newStock={commission:9.99,year:40,dividend_frequency:"auto",initType:"cash"},v.fields=r.DIVIDEND_SUMMARY_FIELDS,v.stockData={},v.calculatedData={},v.dividends=[],v.initDividend={},v.currentPortfolio=null,v.loading=!1,v.addToDd=!1,v.showAddFundModal=!1,v.portfolioOption={},v.fiveYears=d.generateYears(40,5),v.calculate=k,v.goto=u.goto,v.addToDatabank=w,v.addToWatchlist=A,v.addToScreener=C,v.print=$,v.onChangePortfolio=b,v.buy=D,v.onAddFund=P,m.on("BODY_CLICKED",(()=>{v.addToDd&&(v.addToDd=!1)})))}angular.module("fm").controller("DividendCalculatorAddController",e),e.$inject=["$scope","$rootScope","$timeout","$filter","$location","ApiService","StockService","StockParser","PermissionService","ToastService","DividendService","AnchorService","Broadcast","Databank","Screener","Watchlist","BuyStockService","Portfolio"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,c,l,d,u,m,f){let h=this;function g(e){let t={page_size:h.pageSize,page:h.currentPage};return e&&(t=_.extend(t,e),e.sector&&0==e.sector.indexOf("--")&&delete t.sector,e.industry&&0==e.industry.indexOf("--")&&delete t.industry),h.order&&(t.ordering=h.order),o.getAll(t).then((e=>{var t;return h.total=e.count,h.stocks=(t=e.results,_.each(t,(e=>{e.prePriceChangeDisplay=c.parsePriceChangeDisplay(e,"pre")})),t),h.showing=`${(h.currentPage-1)*h.pageSize+1} - ${(h.currentPage-1)*h.pageSize+h.pageSize-1}`,h.stocks})).then((e=>{n((async()=>{for(const t of e)(!t.updated_at||moment().diff(moment(t.updated_at),"minutes")>60)&&await S(t)}),200)}))}function p(){h.currentPage--,g()}function y(){h.currentPage++,g()}function v(e){h.currentPage=1,g(e)}function b(e){let t={code:e.stock.symbol,name:e.stock.shortname};o.create(t).then((({data:e})=>{e.new=!0,_.each(h.stocks,(e=>e.new=!1)),h.stocks.unshift(e),h.total>h.pageSize&&h.stocks.pop(),S(e),s.success({title:"Add stock success",body:"The stock has been added to your screener"})})).catch((({data:e})=>{let t="Failed to add the stock to your screener";e&&e.non_field_errors&&(t="This stock is already exist in your screener"),s.danger({title:"Add stock failed",body:t})}))}function k(e){l.show().then((()=>{o.remove(e.id).then((()=>{_.remove(h.stocks,(t=>t.code===e.code)),h.total--,s.success({title:"Delete stock success",body:"The stock has been deleted from your screener"})})).catch((({data:e})=>{s.danger({title:"Add stock failed",body:"Failed to add the stock to your screener"})}))}))}function S(e){if(!e.syncing)return e.syncing=!0,i.stockInfo(e.code).then((({data:t})=>{console.log(t);let n=c.parseInfo(t);return _.extend(e,n)})).then((e=>(console.log("Synced"),e.sector&&e.industry?e:i.stockProfile(e.code).then((({data:t})=>(console.log("--------data",t),e.sector=t.assetProfile.sector?t.assetProfile.sector.replace("Services",""):"",e.industry=t.assetProfile.industry?t.assetProfile.industry.split("—")[0]:"",e)))))).then((e=>o.partialUpdate(e.id,e))).finally((()=>{e.syncing=!1}))}function w(e,t){t.stopPropagation(),e.showAction=!1;let n=_.clone(e);n.id=void 0,d.create(n).then((({data:e})=>{s.success({title:"Add stock success",body:"The stock has been added to your watchlist"})})).catch((({data:e})=>{let t="Failed to add the stock to your watchlist";e&&e.non_field_errors&&(t="This stock is already exist in your watchlist"),s.danger({title:"Add stock failed",body:t})}))}function C(e){$event.stopPropagation(),e.showAction=!1;let t=_.clone(e);t.id=void 0,u.create(t).then((({data:e})=>{s.success({title:"Add stock success",body:"The stock has been added to your databank"})})).catch((({data:e})=>{let t="Failed to add the stock to your databank";e&&e.non_field_errors&&(t="This stock is already exist in your databank"),s.danger({title:"Add stock failed",body:t})}))}function A(e){h.order==e?h.order=`-${e}`:h.order=e,h.currentPage=1,g()}function $(e){h.closeAt=c.getCloseTime(e),h.preCloseAt=c.getCloseTime(e,!1,"pre")}function D(e){f.show(e).then((()=>{console.log("buy then")})).catch((()=>{console.log("buy cache")}))}r.is_permit("screener")&&(console.log("[ScreenerController] activate"),h.stocks=[],h.total=0,h.currentPage=1,h.showing="",h.pageSize=50,h.isEdit=!1,h.pagingCallback={},h.newStock={},h.order="code",h.closeAt="",h.filter={sector:"--All Sector--",industry:"--All Industry--"},h.pagingCallback.goBack=p,h.pagingCallback.goNext=y,h.filterScreener=v,h.addStock=b,h.deleteStock=k,h.syncInfo=S,h.addToWatchlist=w,h.addToDatabank=C,h.reorder=A,h.buy=D,g().then((()=>{if(h.total>0){let e=_.find(h.stocks,(e=>e.pre_price));$(e||h.stocks[0])}})),o.sectors().then((({data:e})=>{h.sectors=e||[],h.sectors.unshift("--All Sector--")})),o.industries().then((({data:e})=>{h.industries=e||[],h.industries.unshift("--All Industry--")})),m.on("BODY_CLICKED",(()=>{n((()=>{_.each(h.stocks,(e=>{e.showAction=!1}))}))})))}angular.module("fm").controller("ScreenerController",e),e.$inject=["$scope","$rootScope","$timeout","Screener","StockService","YahooService","PermissionService","ToastService","StockParser","ConfirmService","Watchlist","Databank","Broadcast","BuyStockService"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,c,l,d,u,m,f,h,g,p){let y=this;function v(e){let t={page_size:y.pageSize,page:y.currentPage};return e&&(t=_.extend(t,e),e.sector&&0==e.sector.indexOf("--")&&delete t.sector,e.industry&&0==e.industry.indexOf("--")&&delete t.industry),y.order&&(t.ordering=y.order),c.getAll(t).then((e=>{var t;return y.total=e.count,y.stocks=(t=e.results,_.each(t,(e=>{e.priceChangeDisplay=m.parsePriceChangeDisplay(e)})),t),y.showing=`${(y.currentPage-1)*y.pageSize+1} - ${(y.currentPage-1)*y.pageSize+y.pageSize-1}`,y.stocks})).then((e=>{n((async()=>{for(const t of e)(!t.updated_at||moment().diff(moment(t.updated_at),"minutes")>60)&&await P(t)}),200)}))}function b(){y.currentPage--,v()}function k(){y.currentPage++,v()}function S(e){y.currentPage=1,v(e)}function w(e){if(!y.filter.stock_list)return void f.danger({title:"Add stock failed",body:"Please choose a list and add again"});let t={code:e.stock.symbol,name:e.stock.shortname,stock_list:y.filter.stock_list};c.create(t).then((({data:e})=>{e.new=!0,_.each(y.stocks,(e=>e.new=!1)),y.stocks.unshift(e),y.total>y.pageSize&&y.stocks.pop(),P(e),f.success({title:"Add stock success",body:"The stock has been added to your databank"})})).catch((({data:e})=>{let t="Failed to add the stock to your databank";e&&e.non_field_errors&&(t="This stock is already exist in your databank"),f.danger({title:"Add stock failed",body:t})}))}function C(e){h.show().then((()=>{c.remove(e.id).then((()=>{_.remove(y.stocks,(t=>t.code===e.code)),y.total--,f.success({title:"Delete stock success",body:"The stock has been deleted from your databank"})})).catch((({data:e})=>{f.danger({title:"Add stock failed",body:"Failed to add the stock to your databank"})}))}))}function A(e,t){t.stopPropagation(),e.showAction=!1;let n=_.clone(e);n.id=void 0,d.create(n).then((({data:e})=>{f.success({title:"Add stock success",body:"The stock has been added to your watchlist"})})).catch((({data:e})=>{let t="Failed to add the stock to your watchlist";e&&e.non_field_errors&&(t="This stock is already exist in your watchlist"),f.danger({title:"Add stock failed",body:t})}))}function $(e,t){t.stopPropagation(),e.showAction=!1;let n=_.clone(e);n.id=void 0,l.create(n).then((({data:e})=>{f.success({title:"Add stock success",body:"The stock has been added to your screener"})})).catch((({data:e})=>{let t="Failed to add the stock to your screener";e&&e.non_field_errors&&(t="This stock is already exist in your screener"),f.danger({title:"Add stock failed",body:t})}))}function D(e){y.order==e?y.order=`-${e}`:y.order=e,y.currentPage=1,v()}function P(e){const t=e.code;let o={};return e.syncing=!0,Promise.all([a.stockInfo(t).then((({data:e})=>{o.summary=e})),a.stockChart(t).then((({data:e})=>{o.chart=e})),a.stockProfile(t).then((({data:e})=>{o.profile=e})),a.stockFinances(t).then((({data:e})=>{o.finances=e}))]).then((()=>(_.each(["balanceSheetHistory","balanceSheetHistoryQuarterly","cashflowStatementHistory","cashflowStatementHistoryQuarterly","incomeStatementHistory","incomeStatementHistoryQuarterly"],(e=>{o.summary[e]=o.finances[e]})),o.summary.assetProfile=o.profile.assetProfile,o=m.parse(o),o))).then((t=>Object.assign(e,function(e){let t=_.pick(e,["sector","industry","volume","exchange","currency","pre_price","pre_price_change","pre_percent_change","pre_market_time"]);return t=Object.assign(t,{name:e.displayName,price:e.currentStockPrice,volume:e.dailyVoume,price_change:e.priceChange,percent_change:e.priceChangePercentage,market_time:e.marketTime,daily_high:e.dailyHigh,daily_low:e.dailyLow,fiftytwo_week_low:e.fiftyTwoWeekLow,fiftytwo_week_high:e.fiftyTwoWeekHigh,dividend_frequency:e.dividendFrequency,dividend_rate:e.dividendRate,dividend_yield:_.isNumber(e.dividendYield)?e.dividendYield:void 0,ex_dividend_date:_.isDate(e.exDividendDate)?moment(e.exDividendDate).format("YYYY-MM-DD"):void 0,payment_date:_.isDate(e.dividendDate)?moment(e.dividendDate).format("YYYY-MM-DD"):void 0}),t}(t)))).then((e=>c.partialUpdate(e.id,e))).finally((()=>{n((()=>{e.syncing=!1}))}))}function I(e){y.currentStockList=e,e&&v(y.filter)}function x(){y.databankModalAction="new",y.showAddDatabankModal=!0}function M(){y.databankModalAction="update",y.showAddDatabankModal=!0}function E(){h.show({content:`Do you want to delete Databank ${y.currentStockList.name}`}).then((()=>{g.remove(y.currentStockList.id).then((()=>{f.success({title:"Delete Databank",body:"Your databank has been deleted"}),y.stockListOptions.refresh()})).catch((()=>{f.danger({title:"Delete Watchlist",body:"Failed to delete your watchlist"})}))}))}function T(e){console.log("onNewDatabank:",e),y.stockListOptions.refreshAndSelect(e.id)}function N(e){p.show(e).then((()=>{console.log("buy then")})).catch((()=>{console.log("buy cache")}))}s.is_permit("databank")&&(console.log("[DatabankController] activate"),y.stocks=[],y.total=0,y.currentPage=1,y.showing="",y.pageSize=50,y.isEdit=!1,y.pagingCallback={},y.newStock={},y.order="code",y.closeAt="",y.currentStockList=null,y.filter={sector:"--All Sector--",industry:"--All Industry--"},y.showAddDatabankModal=!1,y.databankModalAction="new",y.stockListOptions={},y.pagingCallback.goBack=b,y.pagingCallback.goNext=k,y.filterDatabank=S,y.addStock=w,y.deleteStock=C,y.syncInfo=P,y.addToWatchlist=A,y.addToScreener=$,y.reorder=D,y.onChangeList=I,y.addDatabank=x,y.updateDatabank=M,y.removeDatabank=E,y.onNewDatabank=T,y.buy=N,c.sectors().then((({data:e})=>{y.sectors=e||[],y.sectors.unshift("--All Sector--")})),c.industries().then((({data:e})=>{y.industries=e||[],y.industries.unshift("--All Industry--")})),u.on("BODY_CLICKED",(()=>{n((()=>{_.each(y.stocks,(e=>{e.showAction=!1}))}))})))}angular.module("fm").controller("DatabankController",e),e.$inject=["$scope","$rootScope","$timeout","$filter","ApiService","StockService","YahooService","PermissionService","Databank","Screener","Watchlist","Broadcast","StockParser","ToastService","ConfirmService","StockList","BuyStockService"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,c,l,d,u,m,f,h){let g=this;function p(e){let t={page_size:g.pageSize,page:g.currentPage,stock_list:g.filter.stock_list};e&&(t.search=e),g.order&&(t.ordering=g.order),d.getAll(t).then((e=>(g.total=e.count,g.stocks=e.results,g.showing=`${(g.currentPage-1)*g.pageSize+1} - ${(g.currentPage-1)*g.pageSize+g.pageSize-1}`,g.stocks))).then((e=>{n((async()=>{for(const t of e)(!t.updated_at||moment().diff(moment(t.updated_at),"minutes")>60)&&await $(t)}),200)}))}function y(){g.currentPage--,p()}function v(){g.currentPage++,p()}function b(e){g.currentPage=1,p(e)}function k(e){if(!e.stock)return;if(!g.filter.stock_list)return void s.danger({title:"Add stock failed",body:"Please choose a list and add again"});let t={code:e.stock.symbol,name:e.stock.shortname,stock_list:g.filter.stock_list};d.create(t).then((({data:e})=>{e.new=!0,_.each(g.stocks,(e=>e.new=!1)),g.stocks.unshift(e),g.total>g.pageSize&&g.stocks.pop(),$(e),s.success({title:"Add stock success",body:"The stock has been added to your watchlist"})})).catch((({data:e})=>{let t="Failed to add the stock to your watchlist";e&&e.non_field_errors&&(t="This stock is already exist in your watchlist"),s.danger({title:"Add stock failed",body:t})}))}function S(e){l.show().then((()=>{d.remove(e.id).then((()=>{_.remove(g.stocks,(t=>t.code===e.code)),g.total--,s.success({title:"Delete stock success",body:"The stock has been deleted from your watchlist"})})).catch((({data:e})=>{s.danger({title:"Add stock failed",body:"Failed to add the stock to your watchlist"})}))}))}function w(e,t){t.stopPropagation(),e.showAction=!1;let n=_.clone(e);n.id=void 0,o.create(n).then((({data:e})=>{s.success({title:"Add stock success",body:"The stock has been added to your screener"})})).catch((({data:e})=>{let t="Failed to add the stock to your screener";e&&e.non_field_errors&&(t="This stock is already exist in your screener"),s.danger({title:"Add stock failed",body:t})}))}function C(e){$event.stopPropagation(),e.showAction=!1;let t=_.clone(e);t.id=void 0,u.create(t).then((({data:e})=>{s.success({title:"Add stock success",body:"The stock has been added to your databank"})})).catch((({data:e})=>{let t="Failed to add the stock to your databank";e&&e.non_field_errors&&(t="This stock is already exist in your databank"),s.danger({title:"Add stock failed",body:t})}))}function A(e){g.order==e?g.order=`-${e}`:g.order=e,g.currentPage=1,p()}function $(e){if(!e.syncing)return e.syncing=!0,i.stockInfo(e.code).then((({data:t})=>{console.log(t);let n=c.parseInfo(t);return _.extend(e,n)})).then((e=>d.partialUpdate(e.id,e))).finally((()=>{e.syncing=!1}))}function D(e){g.currentStockList=e,e&&p()}function P(){g.watchlistModalAction="new",g.showAddWatchlistModal=!0}function I(){g.watchlistModalAction="update",g.showAddWatchlistModal=!0}function x(){l.show({content:`Do you want to delete Watchlist ${g.currentStockList.name}`}).then((()=>{f.remove(g.currentStockList.id).then((()=>{s.success({title:"Delete Watchlist",body:"Your watchlist has been deleted"}),g.stockListOptions.refresh()})).catch((()=>{s.danger({title:"Delete Watchlist",body:"Failed to delete your watchlist"})}))}))}function M(e){console.log("onNewWatchlist:",e),g.stockListOptions.refreshAndSelect(e.id)}function E(e){h.show(e).then((()=>{console.log("buy then")})).catch((()=>{console.log("buy cache")}))}r.is_permit("watchlist")&&(console.log("[WatchlistController] activate"),g.stocks=[],g.total=0,g.currentPage=1,g.pageSize=50,g.isEdit=!1,g.pagingCallback={},g.newStock={},g.order="code",g.filter={},g.showAddWatchlistModal=!1,g.currentStockList=null,g.watchlistModalAction="new",g.stockListOptions={},g.pagingCallback.goBack=y,g.pagingCallback.goNext=v,g.filterWatchlist=b,g.addStock=k,g.deleteStock=S,g.addToScreener=w,g.addToDatabank=C,g.reorder=A,g.onChangeList=D,g.addWatchlist=P,g.updateWatchlist=I,g.removeWatchlist=x,g.onNewWatchlist=M,g.buy=E,m.on("BODY_CLICKED",(()=>{_.each(g.stocks,(e=>e.showAction=!1))})))}angular.module("fm").controller("WatchlistController",e),e.$inject=["$scope","$rootScope","$timeout","Screener","StockService","YahooService","PermissionService","ToastService","StockParser","ConfirmService","Watchlist","Databank","Broadcast","StockList","BuyStockService"]}(),function(){"use strict";function e(e,t,n,o,i,a,r,s,c,l,d,u,m,f,h,g,p,y){let v=this;function b(e){v.currentPortfolio=e}function k(){v.modalType="withdraw",v.showModal=!0}function S(){v.modalType="add",v.showModal=!0}function w(e){let t=null;t="add"===v.modalType?y.addBalance:y.withdraw,t(v.currentPortfolio.id,{amount:e}).then((e=>{f.success({title:"Add Balance",body:"Your portfolio has been updated new balance"}),v.showModal=!1,v.portfolioOption&&v.portfolioOption.refresh&&v.portfolioOption.refresh()})).catch((e=>{console.log(e),f.danger({title:"Add Balance",body:"Your amount is not valid or you don't have permission on this portfolio"})}))}s.is_permit("portfolio")&&(v.myPortfolio={},v.currentPortfolio=null,v.portfolioOption={},v.showModal=!1,v.modalType="add",v.onChangePortfolio=b,v.showAddBalance=S,v.showWithdrawBalance=k,v.updateBalance=w,console.log("[PortfolioController] activate"))}angular.module("fm").controller("PortfolioController",e),e.$inject=["$scope","$rootScope","$timeout","$filter","ApiService","StockService","YahooService","PermissionService","Databank","Screener","Watchlist","Broadcast","StockParser","ToastService","ConfirmService","StockList","BuyStockService","Portfolio"]}(),angular.module("fm").factory("BankService",["$rootScope","$http","AppConfig",function(e,t,n){var o=n.API_PREFIX;return{getBanks:function(){return t.get(o+"bank/banks/")},getBank:function(e){return t.get(o+`bank/banks/${e}/`)},createBank:function(e){return t.post(o+"bank/banks/",e)},updateBank:function(e,n){return t.put(o+`bank/banks/${e}/`,n)},deleteBank:function(e){return t.delete(o+`bank/banks/${e}/`)},deleteIncomeItem:function(e){return t.delete(o+`bank/income_items/${e}/`)},createIncomeItem:function(e){return t.post(o+"bank/income_items/",e)},updateIncomeItem:function(e,n){return t.put(o+`bank/income_items/${e}/`,n)},incomeItemUp:function(e){return t.post(o+`bank/income_items/${e}/move_up/`)},incomeItemDown:function(e){return t.post(o+`bank/income_items/${e}/move_down/`)},deleteExpenseCategory:function(e){return t.delete(o+`bank/expense_categories/${e}/`)},createExpenseCategory:function(e){return t.post(o+"bank/expense_categories/",e)},updateExpenseCategory:function(e,n){return t.put(o+`bank/expense_categories/${e}/`,n)},deleteExpenseItem:function(e){return t.delete(o+`bank/expense_items/${e}/`)},createExpenseItem:function(e){return t.post(o+"bank/expense_items/",e)},updateExpenseItem:function(e,n){return t.put(o+`bank/expense_items/${e}/`,n)},expenseItemUp:function(e){return t.post(o+`bank/expense_items/${e}/move_up/`)},expenseItemDown:function(e){return t.post(o+`bank/expense_items/${e}/move_down/`)}}}]),function(){"use strict";function e(e,t,n,o,i,a,r){let s=this;function c(e){_.remove(s.banks,["id",e.id]),"number"==typeof e.id&&r.deleteBank(e.id).then((()=>{console.log("[Bank.controller] deleteBank then")}))}function l(){s.banks.push({id:`b_${Math.random()}`,name:"",color:"#2962ff",income_items:[],editing:!0})}i.is_permit("bank")&&(console.log("[BankController] activate"),s.banks=[],s.bankCallback={deleteBank:c},s.addBank=l,r.getBanks().then((({data:e})=>{s.banks=e.results})))}angular.module("fm").controller("BankController",e),e.$inject=["$scope","$rootScope","$timeout","$filter","PermissionService","ApiService","BankService"]}(),function(){"use strict";function e(e,t,n,o){return{restrict:"E",templateUrl:"views/bank/bank.html",scope:{bank:"=",callback:"="},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope",function(e){let t=this;function i(i){n.show().then((()=>{_.remove(t.bank.income_items,["id",i.id]),r(),e.callback&&e.callback.deleteIncomeItem&&e.callback.deleteIncomeItem.call(null,i),"number"==typeof i.id&&o.deleteIncomeItem(i.id).then((()=>{console.log("[Bank.directive] deleteIncomeItem then")}))}))}function a(){t.bank.income_items.push({id:`i_${Math.random()}`,name:" ",amount:0,bank:t.bank.id,editing:!0})}function r(){t.totalIncome=_.sumBy(t.bank.income_items,"amount"),t.totalExpense=0,t.incomeVsExpense=t.totalIncome-t.totalExpense,e.callback&&e.callback.onTotalChange&&e.callback.onTotalChange.call(null)}function s(e){if(!e.name||""==e.name||void 0===e.amount)return;let t=null;e.amount=_.round(e.amount,2),t="string"==typeof e.id&&e.id.indexOf("i_")>=0?o.createIncomeItem({...e,id:void 0}):o.updateIncomeItem(e.id,e),e.editing=!1,t.then((({data:t})=>{console.log("[Bank.directive] saveIncomeItem then"),e.id=t.id,r()}))}function c(e){e.zero=!e.zero,e.zero?(e.amount_bak=e.amount,e.amount=0):e.amount=e.amount_bak,r()}function l(e){const n=_.findIndex(t.bank.income_items,(t=>t.id==e.id));if(n<0)return;if(n>=t.bank.income_items.length-1)return;const i=t.bank.income_items[n];t.bank.income_items[n]=t.bank.income_items[n+1],t.bank.income_items[n+1]=i,o.incomeItemDown(e.id).then((()=>{console.log("Item moved down")}))}function d(e){const n=_.findIndex(t.bank.income_items,(t=>t.id==e.id));if(n<=0)return;if(n>t.bank.income_items.length-1)return;const i=t.bank.income_items[n];t.bank.income_items[n]=t.bank.income_items[n-1],t.bank.income_items[n-1]=i,o.incomeItemUp(e.id).then((()=>{console.log("Item moved up")}))}function u(e){return"number"==typeof e.id}function m(e){if(!e.name||""==e.name)return;let t=null,n="string"==typeof e.id&&e.id.indexOf("b_")>=0;t=n?o.createBank({name:e.name}):o.updateBank(e.id,e),e.editing=!1,t.then((({data:t})=>(console.log("[Bank.directive] doSaveBank then"),e.id=t.id,e.id))).then((t=>{n&&o.getBank(t).then((({data:t})=>{e.expense_categories=t.expense_categories}))}))}function f(t){n.show().then((()=>{e.callback&&e.callback.deleteBank&&e.callback.deleteBank.call(null,t)}))}function h(){t.bank.expense_categories.push({id:`ec_${Math.random()}`,name:" ",bank:t.bank.id,items:[],editing:!0})}function g(e){_.remove(t.bank.expense_categories,["id",e.id]),"number"==typeof e.id&&o.deleteExpenseCategory(e.id).then((()=>{console.log("[Bank.directive] deleteExpenseCategory then")}))}console.log("[bank.directive] activate"),t.bank=e.bank,t.totalIncome=0,t.totalExpense=0,t.incomeVsExpense=0,t.deleteIncomeItem=i,t.addIncomeItem=a,t.calculateTotal=r,t.saveIncomeItem=s,t.setZero=c,t.itemMoveUp=d,t.itemMoveDown=l,t.canMove=u,t.doSaveBank=m,t.doDeleteBank=f,t.addCategory=h,t.categoryCallback={deleteExpenseCategory:g},e.callback&&e.callback.ready&&e.callback.ready.call(null),r()}]}}angular.module("fm").directive("fmBank",e),e.$inject=["$timeout","ApiService","ConfirmService","BankService"]}(),function(){"use strict";function e(e,t,n,o){return{restrict:"E",templateUrl:"views/bank/category.html",scope:{bank:"=",category:"=",callback:"="},link:(e,t,n)=>{},controllerAs:"vm",controller:["$scope",function(e){let t=this;function i(i){n.show().then((()=>{_.remove(t.category.items,["id",i.id]),r(),e.callback&&e.callback.deleteExpenseItem&&e.callback.deleteExpenseItem.call(null,i),"number"==typeof i.id&&o.deleteExpenseItem(i.id).then((()=>{console.log("[Bank.directive] deleteExpenseItem then")}))}))}function a(){t.category.items.push({id:`ei_${Math.random()}`,name:" ",date:new Date,amount:0,category:t.category.id,editing:!0})}function r(){t.totalExpense=_.sumBy(t.category.items,"amount")}function s(e){if(!e.name||""==e.name||!e.amount||!e.date)return;let t=null;e.amount=_.round(e.amount,2),e.amount>0&&(e.amount=-e.amount),e.date&&(e.date=moment(e.date).format("YYYY-MM-DD")),t="string"==typeof e.id&&e.id.indexOf("ei_")>=0?o.createExpenseItem({...e,id:void 0}):o.updateExpenseItem(e.id,e),e.editing=!1,t.then((({data:t})=>{console.log("[BankExpenseCategory.directive] saveExpenseItem then"),e.id=t.id,r()}))}function c(e){e.zero=!e.zero,e.zero?(e.amount_bak=e.amount,e.amount=0):e.amount=e.amount_bak,r()}function l(e){const n=_.findIndex(t.category.items,(t=>t.id==e.id));if(n<0)return;if(n>=t.category.items.length-1)return;const i=t.category.items[n];t.category.items[n]=t.category.items[n+1],t.category.items[n+1]=i,o.expenseItemDown(e.id).then((()=>{console.log("Item moved down")}))}function d(e){const n=_.findIndex(t.category.items,(t=>t.id==e.id));if(n<=0)return;if(n>t.category.items.length-1)return;const i=t.category.items[n];t.category.items[n]=t.category.items[n-1],t.category.items[n-1]=i,o.expenseItemUp(e.id).then((()=>{console.log("Item moved up")}))}function u(e){return"number"==typeof e.id}function m(e){if(!e.name||""==e.name)return;let t=null;t="string"==typeof e.id&&e.id.indexOf("ec_")>=0?o.createExpenseCategory({...e,id:void 0}):o.updateExpenseCategory(e.id,e),e.editing=!1,t.then((({data:t})=>{console.log("[Bank.directive] doSaveCategory then"),e.id=t.id}))}function f(t){n.show().then((()=>{e.callback&&e.callback.deleteExpenseCategory&&e.callback.deleteExpenseCategory.call(null,t)}))}console.log("[bankExpenseCategory.directive] activate"),t.bank=e.bank,t.category=e.category,t.totalExpense=0,t.deleteExpenseItem=i,t.addExpenseItem=a,t.calculateTotal=r,t.saveExpenseItem=s,t.setZero=c,t.itemMoveUp=d,t.itemMoveDown=l,t.canMove=u,t.doSaveCategory=m,t.doDeleteCategory=f,e.callback&&e.callback.ready&&e.callback.ready.call(null),t.datePickerOptions={initDate:new Date,showWeeks:!1},r()}]}}angular.module("fm").directive("fmExpenseCategory",e),e.$inject=["$timeout","ApiService","ConfirmService","BankService"]}();